# 部署检查清单 (Deployment Checklist)

> 确保部署前后的所有关键步骤不遗漏

**版本：** 1.0.0
**最后更新：** 2026-02-07
**相关 SOP：** [deployment.md](../sops/deployment.md)

---

## 📋 部署前检查清单

### 代码准备
- [ ] 所有 PR 已合并到 release 分支
- [ ] 代码审查全部完成（至少 1 个 Approve）
- [ ] CI/CD 全部通过 ✅
- [ ] 无未解决的 P0/P1 Bug
- [ ] Breaking Changes 已记录在 CHANGELOG

### 测试验证
- [ ] 单元测试通过（覆盖率 >80%）
- [ ] 集成测试通过
- [ ] E2E 测试通过
- [ ] 性能测试通过（无回归）
- [ ] 安全扫描通过（无高危漏洞）

### 文档更新
- [ ] README 更新（如适用）
- [ ] API 文档更新（如适用）
- [ ] CHANGELOG 更新
- [ ] 版本号更新（package.json）
- [ ] 发布说明准备完成

### 环境准备
- [ ] Staging 环境部署成功
- [ ] Staging 环境冒烟测试通过
- [ ] 生产环境备份完成
- [ ] 回滚脚本准备完成
- [ ] 监控告警配置完成

### 人员准备
- [ ] 部署窗口已安排（避开高峰）
- [ ] 相关人员已通知（工程师、运维、产品）
- [ ] Oncall 工程师待命
- [ ] 回滚负责人指定

---

## 🚀 部署执行清单

### 部署操作
- [ ] 切换到正确的分支/标签
  ```bash
  git checkout v2.4.0
  ```
- [ ] 拉取最新代码
  ```bash
  git pull origin v2.4.0
  ```
- [ ] 安装生产依赖
  ```bash
  bun install --production
  ```
- [ ] 执行数据迁移（如有）
  ```bash
  bun run migrate --env=production
  ```
- [ ] 重启服务
  ```bash
  pm2 restart prism-gateway-api
  ```

### 立即验证（< 5 分钟）
- [ ] 进程状态正常
  ```bash
  pm2 status  # 预期：online
  ```
- [ ] 健康检查通过
  ```bash
  curl https://api.prism-gateway.io/health
  # 预期：{"status":"healthy"}
  ```
- [ ] 无错误日志
  ```bash
  pm2 logs --lines 50 | grep ERROR  # 预期：无 ERROR
  ```

---

## ✅ 部署后验证清单

### 功能验证（< 15 分钟）
- [ ] Gateway 检查功能正常
- [ ] 复盘功能正常
- [ ] Analytics 功能正常
- [ ] MCP Server 连接正常
- [ ] API 端点全部可访问

### 性能验证（< 30 分钟）
- [ ] 响应时间正常（P95 < 1000ms）
- [ ] 错误率正常（< 1%）
- [ ] CPU 使用率正常（< 80%）
- [ ] 内存使用率正常（< 80%）
- [ ] 磁盘使用率正常（< 80%）

### 数据验证
- [ ] 数据完整性检查通过
- [ ] 数据迁移成功（如有）
- [ ] 备份文件完整
- [ ] 日志正常写入

---

## 📢 发布通知清单

- [ ] 内部通知（Slack #deployments）
- [ ] 用户通知（邮件/公告）
- [ ] 文档站点更新
- [ ] GitHub Release 创建
- [ ] 社交媒体发布（如适用）

---

## 🚨 回滚检查清单

### 回滚触发条件
- [ ] 服务完全不可用（P0）
- [ ] 核心功能故障且无快速修复（P1）
- [ ] 错误率 >10%
- [ ] 性能下降 >50%

### 回滚操作
- [ ] 停止当前服务
- [ ] 切换到上一版本
- [ ] 回滚数据迁移（如有）
- [ ] 恢复备份（如需要）
- [ ] 重启服务
- [ ] 验证健康检查
- [ ] 通知团队和用户

---

## 📊 部署后监控清单（24 小时）

### 持续监控
- [ ] 每小时检查错误率
- [ ] 每 2 小时检查性能指标
- [ ] 每 4 小时检查用户反馈
- [ ] 每 8 小时检查系统资源

### 日志审查
- [ ] 检查 ERROR 日志
- [ ] 检查 WARN 日志
- [ ] 检查异常访问模式
- [ ] 检查性能瓶颈

---

**检查清单使用说明：**
1. 部署前打印本清单
2. 逐项检查并签名确认
3. 完成后归档到文档库
4. 定期回顾和改进清单

**维护者：** SRE 组
**审核周期：** 每季度
