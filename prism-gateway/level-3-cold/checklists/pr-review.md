# PR 审查检查清单 (PR Review Checklist)

> 确保代码质量、安全性和可维护性的系统化审查

**版本：** 1.0.0
**最后更新：** 2026-02-07
**相关 SOP：** [code-review.md](../sops/code-review.md)

---

## 🔴 P0 - 必须检查（阻塞性）

### 安全性
- [ ] **无 SQL 注入风险**
  - 使用参数化查询
  - 输入验证完整
- [ ] **无 XSS 漏洞**
  - 输出转义正确
  - Content-Type 正确设置
- [ ] **无路径遍历漏洞**
  - 路径验证完整
  - 使用 pathValidator
- [ ] **无敏感信息泄露**
  - 日志中无密码/Token
  - 错误消息不泄露内部信息
- [ ] **输入验证完整**
  - 使用 Zod 验证
  - 边界值检查

### 正确性
- [ ] **逻辑正确**
  - 业务逻辑符合需求
  - 边界条件处理正确
- [ ] **错误处理完整**
  - 所有异常被捕获
  - 错误信息清晰
  - 资源正确释放
- [ ] **并发安全**
  - 无竞态条件
  - 使用文件锁（如需要）
  - 事务处理正确

### 测试覆盖
- [ ] **关键路径有测试**
  - Happy path 测试
  - Error path 测试
- [ ] **边界条件有测试**
  - 空值、null、undefined
  - 最大值、最小值
  - 非法输入
- [ ] **测试覆盖率 >80%**
  - 运行 `bun test --coverage`
  - 检查未覆盖的分支

---

## 🟠 P1 - 重要检查

### 代码质量
- [ ] **命名清晰**
  - 变量名见名知义
  - 函数名使用动词开头
  - 类名使用名词
  - 常量使用大写下划线
- [ ] **函数单一职责**
  - 函数长度 <50 行
  - 只做一件事
  - 参数数量 ≤5 个
- [ ] **复杂度合理**
  - 圈复杂度 <10
  - 嵌套层级 ≤3 层
  - if/else 可读性好
- [ ] **无重复代码**
  - 相同逻辑提取成函数
  - 使用继承/组合复用

### 类型安全
- [ ] **类型注解完整**
  - 函数参数有类型
  - 函数返回值有类型
  - 变量类型明确
- [ ] **无 `any` 滥用**
  - 仅在必要时使用 `any`
  - 优先使用 `unknown`
  - 使用类型守卫
- [ ] **类型推导正确**
  - TypeScript 能正确推导类型
  - 无类型断言滥用

### 性能
- [ ] **无明显性能问题**
  - 避免 N+1 查询
  - 使用缓存（如适用）
  - 大数组操作优化
- [ ] **算法复杂度合理**
  - 时间复杂度可接受
  - 空间复杂度可接受
- [ ] **资源使用合理**
  - 内存泄漏检查
  - 文件描述符管理
  - 定时器清理

---

## 🟡 P2 - 建议检查

### 可维护性
- [ ] **注释充分**
  - 复杂逻辑有注释
  - 公共方法有 TSDoc
  - 不注释显而易见的代码
- [ ] **文档完整**
  - README 更新（如适用）
  - API 文档更新（如适用）
  - 示例代码提供
- [ ] **易于理解**
  - 代码自解释
  - 变量名清晰
  - 逻辑流程清晰

### 一致性
- [ ] **遵循项目规范**
  - 遵循 TypeScript 规范
  - 遵循命名约定
  - 遵循目录结构
- [ ] **代码风格统一**
  - Lint 检查通过
  - 格式化统一
  - Import 顺序统一
- [ ] **文件结构合理**
  - 文件长度适中（<500 行）
  - 模块职责清晰
  - 依赖关系合理

---

## 💡 其他检查

### Git 提交
- [ ] **提交信息清晰**
  - 格式：`<type>: <description>`
  - 描述简洁明了
- [ ] **提交历史整洁**
  - 无无意义提交
  - 无 "fix typo" 提交
  - 提交粒度合理

### PR 描述
- [ ] **变更摘要清晰**
  - 说明变更目的
  - 说明变更内容
- [ ] **关联 Issue**
  - 使用 `Closes #XXX`
  - 说明关联关系
- [ ] **测试说明完整**
  - 如何测试
  - 预期结果
- [ ] **Breaking Changes 说明**
  - 列出所有不兼容变更
  - 提供迁移指南

---

## ✅ 审查完成确认

### 审查者确认
- [ ] 我已仔细审查所有代码
- [ ] 我已测试关键功能（如需要）
- [ ] 我已验证测试覆盖率
- [ ] 我已检查安全性问题
- [ ] 我认为此 PR 可以合并

### 作者确认
- [ ] 我已解决所有 🔴 Blocker 评论
- [ ] 我已处理所有 🟠 Important 评论
- [ ] 我已更新相关文档
- [ ] CI/CD 全部通过
- [ ] 我已自检代码

---

## 📝 审查评论模板

### Blocker 评论
```markdown
# 🔴 必须修改
[详细说明问题]

**建议方案：**
\```typescript
// 修改后的代码
\```

**理由：**
[说明为什么必须修改]
```

### Important 评论
```markdown
# 🟠 强烈建议
[说明建议]

**理由：**
[说明为什么建议这样做]
```

### 表扬评论
```markdown
# ✅ 做得好
[具体说明哪里做得好]
```

---

## 🔗 相关资源

- [代码审查 SOP](../sops/code-review.md)
- [编码规范](../../docs/CODING_STANDARDS.md)
- [测试指南](../../docs/TESTING_GUIDE.md)

---

**维护者：** 质量评估和验收组
**审核周期：** 每季度
