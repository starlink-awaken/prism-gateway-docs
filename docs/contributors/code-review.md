# 代码审查规范

ReflectGuard 项目的代码审查标准和流程。

## 审查目标

代码审查的目的是：

1. **保证代码质量** - 确保代码符合项目标准
2. **知识共享** - 帮助团队成员学习
3. **发现 Bug** - 在合并前发现潜在问题
4. **一致性** - 保持代码风格和架构一致性

## 审查流程

### 1. 自动检查

PR 创建后，CI 会自动运行：

```bash
# Lint 检查
bun run lint

# 类型检查
bun run type-check

# 单元测试
bun test

# 集成测试
bun test tests/integration/
```

所有检查必须通过才能合并。

### 2. 人工审查

至少一名维护者审查代码：

- 查看 PR 描述和变更内容
- 检查代码实现
- 验证测试覆盖
- 确认文档更新

### 3. 反馈循环

- 审查者提供反馈
- 贡献者进行修改
- 推送更新到分支
- PR 自动更新

### 4. 批准合并

- 审查者批准 PR
- 合并到主分支
- 删除功能分支

## 审查标准

### 必须项（阻塞合并）

- [ ] 所有 CI 检查通过
- [ ] 测试覆盖率 >=85%
- [ ] 代码符合项目规范
- [ ] 没有引入新的警告
- [ ] 敏感信息未泄露

### 推荐项（建议修改）

- [ ] 函数复杂度合理（<10）
- [ ] 没有重复代码
- [ ] 变量命名清晰
- [ ] 有适当的注释
- [ ] 性能影响可接受

### 可选项（可以讨论）

- [ ] 替代实现方案
- [ ] 架构改进建议
- [ ] 未来扩展考虑

## 审查清单

### 代码质量

- [ ] 代码可读
- [ ] 逻辑清晰
- [ ] 没有死代码
- [ ] 错误处理适当
- [ ] 资源正确释放

### 测试

- [ ] 测试覆盖核心逻辑
- [ ] 边界条件有测试
- [ ] 错误场景有测试
- [ ] 测试命名清晰
- [ ] 没有脆弱的测试

### 文档

- [ ] 公共 API 有 JSDoc
- [ ] 复杂逻辑有注释
- [ ] README/CHANGELOG 已更新
- [ ] 迁移指南（如需要）

### 性能

- [ ] 没有明显性能问题
- [ ] 内存使用合理
- [ ] 异步操作正确
- [ ] 缓存使用适当

### 安全

- [ ] 输入验证
- [ ] 输出编码
- [ ] 权限检查
- [ ] 敏感数据保护

## 审查反馈规范

### 反馈语气

- 建设性而非批评性
- 解释"为什么"而非只是"什么"
- 认可好的贡献
- 提供改进建议

### 反馈示例

**❌ 不好的反馈：**

```
这个代码很乱，重写。
```

**✅ 好的反馈：**

```
我建议将 `processData` 函数拆分为更小的函数，这样更容易理解。例如，可以将验证逻辑和数据提取逻辑分离。
```

### 审查注释类型

| 类型 | 图标 | 说明 |
|------|------|------|
| 必须修复 | 🚫 | 阻塞合并的问题 |
| 建议修改 | 💡 | 建议的改进 |
| 讨论 | 💬 | 需要讨论的设计决策 |
| 赞许 | 👍 | 认可好的代码 |

## 响应审查

### 贡献者

- 及时响应审查反馈
- 解释设计决策
- 根据反馈修改
- 保持积极态度

### 审查者

- 在 48 小时内完成审查
- 提供清晰的反馈
- 保持沟通开放
- 认可贡献

## 常见问题

### Q: 审查意见不一致怎么办？

**A:** 首先讨论以达成共识。如果无法达成，由项目维护者做出最终决定。

### Q: 审查时间太长怎么办？

**A:** 可以在 PR 中 @ 维护者请求审查。紧急修复可以快速通道。

### Q: 如何成为审查者？

**A:** 持续贡献高质量代码，展示对项目的理解，维护者会邀请你成为审查者。

---

**相关文档：**
- [工作流程](workflow.md)
- [测试要求](testing.md)
- [代码规范](../developers/coding-standards.md)

---

**最后更新:** 2026-02-07
