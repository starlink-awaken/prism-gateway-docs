# 测试检查清单 (Testing Checklist)

> 确保测试完整性、质量和可维护性

**版本：** 1.0.0
**最后更新：** 2026-02-07
**测试目标：** 覆盖率 >80%, 0 失败

---

## ✅ 单元测试

### 测试范围
- [ ] **核心类测试**
  - 所有公共方法
  - 边界条件
  - 错误情况
- [ ] **工具函数测试**
  - 输入输出验证
  - 边界值测试
  - 异常处理
- [ ] **数据模型测试**
  - 验证逻辑
  - 序列化/反序列化
  - 类型安全

### 测试质量
- [ ] **独立性**
  - 测试之间无依赖
  - 可单独运行
  - 顺序无关
- [ ] **可重复性**
  - 每次运行结果一致
  - 无随机失败
  - Mock 外部依赖
- [ ] **清晰性**
  - 测试名称描述性强
  - 使用 AAA 模式（Arrange-Act-Assert）
  - 一个测试一个断言（推荐）

### 测试覆盖
- [ ] **行覆盖率 >80%**
  ```bash
  bun test --coverage
  ```
- [ ] **分支覆盖率 >75%**
- [ ] **关键路径 100% 覆盖**

---

## 🔗 集成测试

### API 测试
- [ ] **端点测试**
  - 所有 HTTP 方法
  - 正常响应
  - 错误响应
- [ ] **认证测试**
  - Token 验证
  - 权限检查
  - 过期处理
- [ ] **数据流测试**
  - 端到端数据流
  - 状态变化验证

### 数据库测试
- [ ] **CRUD 操作**
  - 创建、读取、更新、删除
  - 事务处理
  - 并发控制
- [ ] **迁移测试**
  - 前向迁移
  - 回滚测试
  - 数据完整性

### 外部集成
- [ ] **MCP Server 集成**
- [ ] **文件系统操作**
- [ ] **第三方 API（如有）**

---

## 🎭 端到端测试

### 用户场景
- [ ] **主要用户流程**
  - Gateway 检查流程
  - 复盘流程
  - Analytics 查询流程
- [ ] **边界场景**
  - 大量数据处理
  - 并发访问
  - 网络故障恢复

### 性能测试
- [ ] **响应时间**
  - Gateway 检查 <1000ms
  - API 响应 <500ms
- [ ] **并发测试**
  - 100 并发用户
  - 无资源泄漏
- [ ] **压力测试**
  - 峰值负载测试
  - 降级策略验证

---

## 🐛 错误处理测试

### 异常情况
- [ ] **网络错误**
  - 连接超时
  - 连接断开
  - 重试机制
- [ ] **数据错误**
  - 无效输入
  - 数据损坏
  - 缺失数据
- [ ] **系统错误**
  - 内存不足
  - 磁盘满
  - 权限错误

### 错误恢复
- [ ] **优雅降级**
- [ ] **错误日志记录**
- [ ] **用户友好提示**

---

## 📊 测试指标

### 量化指标
| 指标 | 目标 | 检查方式 |
|------|------|----------|
| **覆盖率** | >80% | `bun test --coverage` |
| **通过率** | 100% | CI/CD |
| **执行时间** | <5 分钟 | CI/CD |
| **失败率** | 0% | 历史统计 |

### 质量指标
- [ ] 无 skip/todo 测试（或有明确理由）
- [ ] 无重复测试
- [ ] 测试代码可维护

---

## 🔧 测试工具

### 推荐工具
- **测试框架：** Bun Test
- **Mock 库：** built-in
- **覆盖率：** built-in
- **E2E：** Playwright（如需要）

---

## 📝 测试代码规范

### 命名规范
```typescript
describe('ClassName', () => {
  describe('methodName()', () => {
    it('should do something when condition', () => {
      // 测试逻辑
    });
  });
});
```

### AAA 模式
```typescript
it('should return sum of two numbers', () => {
  // Arrange (准备)
  const a = 1;
  const b = 2;

  // Act (执行)
  const result = add(a, b);

  // Assert (断言)
  expect(result).toBe(3);
});
```

---

## 🔗 相关资源

- [测试指南](../../docs/TESTING_GUIDE.md)
- [Bun Test 文档](https://bun.sh/docs/cli/test)

---

**维护者：** 质量评估和验收组
**审核周期：** 每季度
