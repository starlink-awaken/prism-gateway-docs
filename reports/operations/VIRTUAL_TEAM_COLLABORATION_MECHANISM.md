# ReflectGuard è™šæ‹Ÿå›¢é˜ŸååŒå·¥ä½œæœºåˆ¶è®¾è®¡

**ç‰ˆæœ¬ï¼š** 1.0.0
**åˆ›å»ºæ—¶é—´ï¼š** 2026-02-05
**è®¾è®¡è€…ï¼š** Nova (é«˜èƒ½åŠ›é—®é¢˜è§£å†³è€…)
**é¡¹ç›®çŠ¶æ€ï¼š** Phase 2 Week 4-5 | Analytics æ¨¡å—å®Œæˆ | API å®‰å…¨åŠ å›º P0

---

## ğŸ“‹ æ–‡æ¡£ç›®å½•

1. [è®¾è®¡èƒŒæ™¯](#1-è®¾è®¡èƒŒæ™¯)
2. [ä»»åŠ¡è·¯ç”±æœºåˆ¶](#2-ä»»åŠ¡è·¯ç”±æœºåˆ¶)
3. [å¹¶è¡Œæ‰§è¡Œç­–ç•¥](#3-å¹¶è¡Œæ‰§è¡Œç­–ç•¥)
4. [å†²çªè§£å†³æµç¨‹](#4-å†²çªè§£å†³æµç¨‹)
5. [é€šä¿¡åè®®](#5-é€šä¿¡åè®®)
6. [è´¨é‡ä¿è¯é›†æˆ](#6-è´¨é‡ä¿è¯é›†æˆ)
7. [å®æ–½æŒ‡å—](#7-å®æ–½æŒ‡å—)
8. [é™„å½•](#8-é™„å½•)

---

## 1. è®¾è®¡èƒŒæ™¯

### 1.1 è™šæ‹Ÿå›¢é˜Ÿè§’è‰²ä½“ç³»å›é¡¾

ReflectGuard å·²å®šä¹‰ **7 ä¸ªä¸“ä¸š Agent è§’è‰²**ï¼š

| è§’è‰² | èŒè´£ | æ¨èæ¨¡å‹ | æ¿€æ´»é¢‘ç‡ |
|------|------|----------|----------|
| **Architect** | æ¶æ„è®¾è®¡ã€æŠ€æœ¯é€‰å‹ | Opus 4.5 | ä½ï¼ˆæŒ‰éœ€ï¼‰ |
| **Engineer** | ä»£ç å¼€å‘ã€æµ‹è¯• | Sonnet 4.5 | é«˜ï¼ˆæ¯æ—¥ï¼‰ |
| **Pentester** | å®‰å…¨å®¡è®¡ã€æ¼æ´ä¿®å¤ | Opus 4.5 | ä¸­ï¼ˆæ¯å‘¨ï¼‰ |
| **QATester** | Code Reviewã€è´¨é‡é—¨ç¦ | Sonnet 4.5 | é«˜ï¼ˆæ¯æ¬¡ PRï¼‰ |
| **Analyst** | æ•°æ®åˆ†æã€å¼‚å¸¸æ£€æµ‹ | Sonnet 4.5 | ä¸­ï¼ˆæ¯å‘¨ï¼‰ |
| **Writer** | æ–‡æ¡£ç¼–å†™ã€ç»´æŠ¤ | Haiku 3.5 | ä¸­ï¼ˆæ¯æ¬¡å˜æ›´ï¼‰ |
| **Coordinator** | åä½œè°ƒåº¦ã€ä»»åŠ¡åˆ†é… | Sonnet 4.5 | é«˜ï¼ˆæ¯æ—¥ï¼‰ |

### 1.2 å½“å‰æŒ‘æˆ˜

**Week 4-5 çŠ¶æ€ï¼š**
- âœ… Analytics æ¨¡å—å®Œæˆï¼ˆ82 æµ‹è¯•ï¼Œ>90% è¦†ç›–ç‡ï¼‰
- ğŸ”´ P0 ä»»åŠ¡ï¼šAPI å®‰å…¨åŠ å›º
- ğŸ”´ P0 ä»»åŠ¡ï¼šè´¨é‡ä¿è¯ä½“ç³»

**æ ¸å¿ƒæŒ‘æˆ˜ï¼š**
1. å¦‚ä½•è®© 7 ä¸ªè™šæ‹Ÿè§’è‰²é«˜æ•ˆååŒï¼Œé¿å…å†²çªï¼Ÿ
2. ä¸åŒç±»å‹ä»»åŠ¡å¦‚ä½•è·¯ç”±åˆ°åˆé€‚çš„è§’è‰²ï¼Ÿ
3. å“ªäº›ä»»åŠ¡å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå“ªäº›å¿…é¡»ä¸²è¡Œï¼Ÿ
4. å¤šä¸ªè§’è‰²æœ‰ä¸åŒæ„è§æ—¶å¦‚ä½•å†³ç­–ï¼Ÿ
5. å¦‚ä½•ç¡®ä¿è´¨é‡åœ¨æµç¨‹ä¸­å§‹ç»ˆå¾—åˆ°ä¿éšœï¼Ÿ

### 1.3 è®¾è®¡ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡ï¼š** å»ºç«‹ä¸€å¥—è½»é‡çº§ã€é«˜æ•ˆç‡çš„ååŒå·¥ä½œæœºåˆ¶ï¼Œè®©è™šæ‹Ÿå›¢é˜ŸåƒçœŸå®å›¢é˜Ÿä¸€æ ·åä½œã€‚

**å…·ä½“ç›®æ ‡ï¼š**
1. **æ™ºèƒ½è·¯ç”±** - è‡ªåŠ¨å°†ä»»åŠ¡è·¯ç”±åˆ°æœ€åˆé€‚çš„è§’è‰²
2. **é«˜æ•ˆå¹¶è¡Œ** - æœ€å¤§åŒ–å¹¶è¡Œæ‰§è¡Œï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
3. **å†²çªé¢„é˜²** - æå‰è¯†åˆ«å†²çªï¼Œé¿å…äº‹åè¡¥æ•‘
4. **è´¨é‡å†…å»º** - å°†è´¨é‡æ£€æŸ¥èå…¥æ¯ä¸ªç¯èŠ‚
5. **ç®€å•é«˜æ•ˆ** - æœºåˆ¶ç®€å•ï¼Œä¸è¿‡åº¦è®¾è®¡

### 1.4 è®¾è®¡åŸåˆ™

åŸºäº **PAI Algorithm çš„å¹¶è¡Œæ‰§è¡ŒåŸåˆ™ï¼ˆFan-out é»˜è®¤æ¨¡å¼ï¼‰**ï¼š

| åŸåˆ™ | è¯´æ˜ | åº”ç”¨ |
|------|------|------|
| **Fan-out ä¼˜å…ˆ** | é»˜è®¤å¹¶è¡Œæ‰§è¡Œï¼Œé™¤éæœ‰æ˜ç¡®ä¾èµ– | å¤šä¸ªè§’è‰²å¯ä»¥åŒæ—¶å·¥ä½œ |
| **Pipeline ä¸²è¡Œ** | æœ‰æ˜ç¡®ä¾èµ–çš„ä»»åŠ¡å¿…é¡»ä¸²è¡Œ | è®¾è®¡ â†’ å®ç° â†’ æµ‹è¯• |
| **ä¾èµ–ç®¡ç†** | è‡ªåŠ¨è¯†åˆ«ä¾èµ–å…³ç³» | TaskList çš„ blockedBy/blocks |
| **è½»é‡çº§** | ä¸å¼•å…¥é‡é‡çº§æ¡†æ¶ | åŸºäºç°æœ‰å·¥å…·ï¼Œç®€å•åè®® |
| **å¯è§‚æµ‹** - æ‰€æœ‰çŠ¶æ€é€æ˜å¯è§ | TaskList + è¿›åº¦æ›´æ–° |

---

## 2. ä»»åŠ¡è·¯ç”±æœºåˆ¶

### 2.1 ä»»åŠ¡åˆ†ç±»å†³ç­–æ ‘

```mermaid
graph TD
    A[æ–°ä»»åŠ¡è¾“å…¥] --> B{ä»»åŠ¡ç±»å‹?}

    B -->|æ¶æ„è®¾è®¡| C[Architect]
    B -->|åŠŸèƒ½å¼€å‘| D{å¤æ‚åº¦?}
    B -->|å®‰å…¨é—®é¢˜| E[Pentester]
    B -->|è´¨é‡é—®é¢˜| F[QATester]
    B -->|æ•°æ®åˆ†æ| G[Analyst]
    B -->|æ–‡æ¡£ç¼–å†™| H[Writer]
    B -->|ä»»åŠ¡åè°ƒ| I[Coordinator]

    D -->|ç®€å•| J[Engineer]
    D -->|å¤æ‚| K[Council æ¨¡å¼]

    E --> L{ä¼˜å…ˆçº§?}
    L -->|P0| M[ç«‹å³æ‰§è¡Œ]
    L -->|P1/P2| N[åŠ å…¥é˜Ÿåˆ—]

    style C fill:#e1f5ff
    style E fill:#ffe1e1
    style K fill:#fff4e1
    style M fill:#ffe1e1
```

### 2.2 ä»»åŠ¡ç±»å‹è¯†åˆ«

#### 2.2.1 å…³é”®è¯åŒ¹é…è§„åˆ™

**Architect ä»»åŠ¡å…³é”®è¯ï¼š**
```
æ¶æ„ã€è®¾è®¡ã€æŠ€æœ¯é€‰å‹ã€é‡æ„ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æ€§ã€æ¨¡å—åˆ’åˆ†ã€æ¥å£è®¾è®¡ã€æ•°æ®æ¨¡å‹
```

**Engineer ä»»åŠ¡å…³é”®è¯ï¼š**
```
å®ç°ã€å¼€å‘ã€ç¼–ç ã€åŠŸèƒ½ã€ä¿®å¤ã€Bugã€é‡æ„ã€ä¼˜åŒ–ã€æµ‹è¯•ã€å•å…ƒæµ‹è¯•
```

**Pentester ä»»åŠ¡å…³é”®è¯ï¼š**
```
å®‰å…¨ã€æ¼æ´ã€æ”»å‡»ã€æ³¨å…¥ã€XSSã€CSRFã€è®¤è¯ã€æˆæƒã€åŠ å¯†ã€æ•æ„Ÿæ•°æ®ã€OWASPã€STRIDE
```

**QATester ä»»åŠ¡å…³é”®è¯ï¼š**
```
æµ‹è¯•ã€éªŒè¯ã€Code Reviewã€è´¨é‡ã€è¦†ç›–ç‡ã€æ€§èƒ½æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å›å½’æµ‹è¯•
```

**Analyst ä»»åŠ¡å…³é”®è¯ï¼š**
```
æ•°æ®ã€æŒ‡æ ‡ã€åˆ†æã€ç»Ÿè®¡ã€è¶‹åŠ¿ã€å¼‚å¸¸ã€ç›‘æ§ã€æŠ¥è¡¨ã€èšåˆ
```

**Writer ä»»åŠ¡å…³é”®è¯ï¼š**
```
æ–‡æ¡£ã€API æ–‡æ¡£ã€READMEã€æŒ‡å—ã€æ•™ç¨‹ã€ç¤ºä¾‹ã€æ³¨é‡Šã€TSDoc
```

**Coordinator ä»»åŠ¡å…³é”®è¯ï¼š**
```
åè°ƒã€åˆ†é…ã€è®¡åˆ’ã€å¤ç›˜ã€å†²çªã€å†³ç­–ã€Councilã€ä¼šè®®
```

#### 2.2.2 è‡ªåŠ¨è·¯ç”±ç®—æ³•

```typescript
interface TaskRouting {
  // ä»»åŠ¡åˆ†æ
  analyzeTask(task: TaskDescription): TaskAnalysis;

  // è§’è‰²åŒ¹é…
  matchRoles(analysis: TaskAnalysis): RoleMatch[];

  // ä¼˜å…ˆçº§è¯„ä¼°
  assessPriority(analysis: TaskAnalysis): Priority;

  // ä¾èµ–è¯†åˆ«
  identifyDependencies(task: TaskDescription): Dependency[];
}

interface TaskDescription {
  title: string;
  description: string;
  context?: {
    tags?: string[];
    relatedFiles?: string[];
    urgency?: 'low' | 'medium' | 'high' | 'critical';
  };
}

interface TaskAnalysis {
  type: TaskType;
  complexity: 'simple' | 'medium' | 'complex';
  securityRelevance: boolean; // æ˜¯å¦æ¶‰åŠå®‰å…¨
  qualityRelevance: boolean;  // æ˜¯å¦æ¶‰åŠè´¨é‡
  dataRelevance: boolean;     // æ˜¯å¦æ¶‰åŠæ•°æ®
  estimatedHours: number;
}

interface RoleMatch {
  role: string;
  confidence: number; // 0-1
  reason: string;
}

// ç¤ºä¾‹è·¯ç”±å†³ç­–
function routeTask(task: TaskDescription): RouteDecision {
  // 1. åˆ†æä»»åŠ¡
  const analysis = analyzeTask(task);

  // 2. åŒ¹é…è§’è‰²
  const matches = matchRoles(analysis);

  // 3. è¯„ä¼°ä¼˜å…ˆçº§
  const priority = assessPriority(analysis);

  // 4. è¯†åˆ«ä¾èµ–
  const dependencies = identifyDependencies(task);

  // 5. ç”Ÿæˆè·¯ç”±å†³ç­–
  return {
    primaryRole: matches[0].role,
    supportingRoles: matches.slice(1).map(m => m.role),
    priority,
    dependencies,
    executionMode: determineExecutionMode(analysis, dependencies)
  };
}

// ç¤ºä¾‹ä½¿ç”¨
const task = {
  title: "REST API å®‰å…¨åŠ å›º",
  description: "ä¸º API æ·»åŠ è®¤è¯ã€éªŒè¯å’Œé™æµæœºåˆ¶",
  context: {
    tags: ["å®‰å…¨", "API", "P0"],
    urgency: "critical"
  }
};

const decision = routeTask(task);
console.log(decision);
// {
//   primaryRole: "Pentester",
//   supportingRoles: ["Architect", "Engineer", "QATester"],
//   priority: "P0",
//   dependencies: [],
//   executionMode: "pipeline"
// }
```

### 2.3 å•è§’è‰² vs å¤šè§’è‰²åä½œ

#### 2.3.1 å•è§’è‰²ä»»åŠ¡åˆ¤å®š

**åˆ¤å®šæ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€å³å¯ï¼‰ï¼š**
1. ä»»åŠ¡å¤æ‚åº¦ä¸º `simple`
2. é¢„è®¡æ—¶é•¿ < 2 å°æ—¶
3. ä¸æ¶‰åŠå¤šä¸ªä¸“ä¸šé¢†åŸŸ
4. æ— è·¨æ¨¡å—å½±å“

**ç¤ºä¾‹ï¼š**
```typescript
const singleRoleTasks = [
  {
    title: "ä¿®å¤ MathUtils.average ç©ºæ•°ç»„é—®é¢˜",
    assignee: "Engineer",
    reason: "ç®€å• Bug ä¿®å¤ï¼Œé¢„è®¡ 30 åˆ†é’Ÿ"
  },
  {
    title: "æ›´æ–° API æ–‡æ¡£",
    assignee: "Writer",
    reason: "æ–‡æ¡£æ›´æ–°ï¼Œä¸æ¶‰åŠä»£ç å˜æ›´"
  },
  {
    title: "ç”Ÿæˆæœ¬å‘¨è´¨é‡æŠ¥å‘Š",
    assignee: "Analyst",
    reason: "æ•°æ®åˆ†æä»»åŠ¡ï¼Œç‹¬ç«‹å®Œæˆ"
  }
];
```

#### 2.3.2 å¤šè§’è‰²åä½œä»»åŠ¡åˆ¤å®š

**åˆ¤å®šæ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€å³å¯ï¼‰ï¼š**
1. ä»»åŠ¡å¤æ‚åº¦ä¸º `medium` æˆ– `complex`
2. é¢„è®¡æ—¶é•¿ â‰¥ 2 å°æ—¶
3. æ¶‰åŠå¤šä¸ªä¸“ä¸šé¢†åŸŸ
4. æœ‰è·¨æ¨¡å—å½±å“

**åä½œæ¨¡å¼ï¼š**

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | è§’è‰²æ•° | æ‰§è¡Œæ–¹å¼ | ç¤ºä¾‹ |
|------|---------|-------|---------|------|
| **é“¾å¼åä½œ** | ç®€å•å¤šè§’è‰²ä»»åŠ¡ | 2-3 | ä¸²è¡Œ Pipeline | Architect â†’ Engineer â†’ QATester |
| **å¹¶è¡Œåä½œ** | ç‹¬ç«‹å­ä»»åŠ¡ | 2-4 | å¹¶è¡Œ Fan-out | Architect + Pentester åŒæ—¶è¯„å®¡ |
| **Council æ¨¡å¼** | å¤æ‚å†³ç­– | 3-7 | è®¨è®º â†’ å†³ç­– â†’ æ‰§è¡Œ | æ¶æ„é‡å¤§å˜æ›´è®¨è®º |

**ç¤ºä¾‹ï¼š**
```typescript
const multiRoleTasks = [
  {
    title: "REST API å®‰å…¨åŠ å›º",
    mode: "pipeline",
    roles: ["Pentester", "Architect", "Engineer", "QATester"],
    reason: "æ¶‰åŠå®‰å…¨è®¾è®¡ã€æ¶æ„è¯„å®¡ã€ä»£ç å®ç°ã€è´¨é‡éªŒè¯"
  },
  {
    title: "WebSocket å®æ—¶é€šä¿¡è®¾è®¡",
    mode: "council",
    roles: ["Architect", "Engineer", "Pentester", "QATester", "Researcher"],
    reason: "é‡å¤§æ¶æ„å†³ç­–ï¼Œéœ€è¦å¤šè§’è‰²è®¨è®º"
  },
  {
    title: "æ€§èƒ½ä¼˜åŒ–",
    mode: "fan-out",
    roles: ["Architect", "Engineer", "Analyst"],
    reason: "å¯å¹¶è¡Œå·¥ä½œï¼šArchitect è®¾è®¡æ–¹æ¡ˆï¼ŒEngineer å®éªŒï¼ŒAnalyst åˆ†æç“¶é¢ˆ"
  }
];
```

### 2.4 ç´§æ€¥ä»»åŠ¡å¿«é€Ÿé€šé“

#### 2.4.1 P0 ä»»åŠ¡å®šä¹‰

**P0ï¼ˆä¸¥é‡ï¼‰ä»»åŠ¡ç‰¹å¾ï¼š**
- ç³»ç»Ÿä¸å¯ç”¨ã€æ•°æ®æ³„éœ²ã€é«˜å±å®‰å…¨æ¼æ´
- ç«‹å³å¤„ç†ï¼Œåœæ­¢å…¶ä»–ä»»åŠ¡
- å“åº”æ—¶é—´ï¼š< 15 åˆ†é’Ÿ

**è‡ªåŠ¨è¯†åˆ«è§„åˆ™ï¼š**
```typescript
function isP0Task(task: TaskDescription): boolean {
  const p0Keywords = [
    'å®‰å…¨æ¼æ´', 'é«˜å±', 'æ•°æ®æ³„éœ²', 'ç³»ç»Ÿä¸å¯ç”¨',
    'SQLæ³¨å…¥', 'XSS', 'CSRF', 'å‘½ä»¤æ³¨å…¥',
    'P0', 'critical', 'severe'
  ];

  const hasP0Keyword = p0Keywords.some(keyword =>
    task.title.includes(keyword) || task.description.includes(keyword)
  );

  const isCriticalUrgency = task.context?.urgency === 'critical';

  return hasP0Keyword || isCriticalUrgency;
}
```

#### 2.4.2 å¿«é€Ÿé€šé“æµç¨‹

```mermaid
graph LR
    A[P0 ä»»åŠ¡è¯†åˆ«] --> B[ç«‹å³ä¸­æ–­å½“å‰ä»»åŠ¡]
    B --> C{Pentester å¯ç”¨?}
    C -->|æ˜¯| D[ç«‹å³æ¿€æ´» Pentester]
    C -->|å¦| E[æ¿€æ´» Architect + Engineer]
    D --> F[æ‰§è¡Œåº”æ€¥å“åº”æµç¨‹]
    E --> F
    F --> G[æŒç»­æ›´æ–°è¿›åº¦]
    G --> H[å®Œæˆåå¤ç›˜]
```

**å¿«é€Ÿé€šé“è§„åˆ™ï¼š**
1. **ç«‹å³ä¸­æ–­** - æš‚åœæ‰€æœ‰é P0 ä»»åŠ¡
2. **è§’è‰²ä¼˜å…ˆ** - ä¼˜å…ˆæ¿€æ´» Pentesterï¼ˆå®‰å…¨ï¼‰æˆ– Architectï¼ˆæ¶æ„ï¼‰
3. **å¹¶è¡Œå‡†å¤‡** - å…¶ä»–è§’è‰²åŒæ—¶å‡†å¤‡ä¸Šä¸‹æ–‡
4. **æŒç»­æ›´æ–°** - æ¯ 15 åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡è¿›åº¦
5. **äº‹åå¤ç›˜** - å®Œæˆåè¿›è¡Œæ·±åº¦å¤ç›˜

**ç¤ºä¾‹ï¼š**
```typescript
// P0 ä»»åŠ¡å¿«é€Ÿé€šé“
const p0Task = {
  title: "å‘ç° SQL æ³¨å…¥æ¼æ´",
  priority: "P0",
  urgency: "critical",
  timestamp: "2026-02-05T14:30:00Z"
};

// 1. ç«‹å³è¯†åˆ«ä¸º P0
if (isP0Task(p0Task)) {
  // 2. ä¸­æ–­å½“å‰ä»»åŠ¡
  interruptCurrentTasks();

  // 3. æ¿€æ´» Pentesterï¼ˆå®‰å…¨ä¸“å®¶ï¼‰
  activateRole("Pentester", {
    task: p0Task,
    mode: "emergency"
  });

  // 4. å¹¶è¡Œå‡†å¤‡å…¶ä»–è§’è‰²
  prepareRoles(["Architect", "Engineer", "QATester"], {
    task: p0Task,
    mode: "standby"
  });

  // 5. å¯åŠ¨åº”æ€¥å“åº”æµç¨‹
  startEmergencyResponse(p0Task);
}
```

---

## 3. å¹¶è¡Œæ‰§è¡Œç­–ç•¥

### 3.1 Fan-out vs Pipeline

#### 3.1.1 æ‰§è¡Œæ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | ç¤ºä¾‹ |
|------|---------|------|------|------|
| **Fan-outï¼ˆå¹¶è¡Œï¼‰** | ç‹¬ç«‹å­ä»»åŠ¡ | é€Ÿåº¦å¿«ã€èµ„æºåˆ©ç”¨ç‡é«˜ | éœ€è¦åè°ƒã€å¯èƒ½å†²çª | æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤šè§’è‰²å¹¶è¡Œåˆ†æï¼‰ |
| **Pipelineï¼ˆä¸²è¡Œï¼‰** | ä¾èµ–ä»»åŠ¡ | é€»è¾‘æ¸…æ™°ã€è´¨é‡å¯æ§ | é€Ÿåº¦æ…¢ã€ç­‰å¾…æ—¶é—´é•¿ | å¼€å‘æµç¨‹ï¼ˆè®¾è®¡ â†’ å®ç° â†’ æµ‹è¯•ï¼‰ |
| **æ··åˆæ¨¡å¼** | å¤æ‚ä»»åŠ¡ | å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡ | å¤æ‚åº¦é«˜ | API å®‰å…¨åŠ å›ºï¼ˆPipeline + Fan-outï¼‰ |

#### 3.1.2 Fan-out å¹¶è¡Œæ‰§è¡Œ

**é€‚ç”¨æ¡ä»¶ï¼ˆæ»¡è¶³æ‰€æœ‰ï¼‰ï¼š**
1. å­ä»»åŠ¡ä¹‹é—´æ— ä¾èµ–å…³ç³»
2. å­ä»»åŠ¡å¯ä»¥ç‹¬ç«‹å®Œæˆ
3. å­ä»»åŠ¡ç»“æœå¯ä»¥åˆå¹¶
4. èµ„æºå……è¶³ï¼ˆè§’è‰²ä¸å†²çªï¼‰

**ç¤ºä¾‹åœºæ™¯ï¼š**
```typescript
// åœºæ™¯ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆFan-out å¹¶è¡Œï¼‰
const performanceOptimization = {
  title: "Gateway Check æ€§èƒ½ä¼˜åŒ–",
  mode: "fan-out",
  subtasks: [
    {
      role: "Architect",
      task: "è®¾è®¡ç¼“å­˜ç­–ç•¥",
      output: "ç¼“å­˜æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£"
    },
    {
      role: "Engineer",
      task: "å®éªŒå¹¶è¡Œæ£€æŸ¥",
      output: "æ€§èƒ½æµ‹è¯•æŠ¥å‘Š"
    },
    {
      role: "Analyst",
      task: "åˆ†ææ€§èƒ½ç“¶é¢ˆ",
      output: "ç“¶é¢ˆåˆ†ææŠ¥å‘Š"
    }
  ],
  mergeStrategy: "Architect ç»¼åˆä¸‰ä¸ªæŠ¥å‘Šï¼Œè¾“å‡ºæœ€ç»ˆä¼˜åŒ–æ–¹æ¡ˆ"
};
```

**Fan-out æ‰§è¡Œæµç¨‹ï¼š**
```mermaid
graph TD
    A[Coordinator åˆ†é…ä»»åŠ¡] --> B[Architect è®¾è®¡ç¼“å­˜]
    A --> C[Engineer å®éªŒ]
    A --> D[Analyst åˆ†æç“¶é¢ˆ]

    B --> E[è¾“å‡º: ç¼“å­˜æ–¹æ¡ˆ]
    C --> F[è¾“å‡º: æµ‹è¯•æŠ¥å‘Š]
    D --> G[è¾“å‡º: ç“¶é¢ˆåˆ†æ]

    E --> H[Architect åˆå¹¶ç»“æœ]
    F --> H
    G --> H

    H --> I[è¾“å‡º: æœ€ç»ˆä¼˜åŒ–æ–¹æ¡ˆ]
```

#### 3.1.3 Pipeline ä¸²è¡Œæ‰§è¡Œ

**é€‚ç”¨æ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€ï¼‰ï¼š**
1. å­ä»»åŠ¡æœ‰æ˜ç¡®çš„ä¾èµ–å…³ç³»
2. å­ä»»åŠ¡çš„è¾“å‡ºæ˜¯ä¸‹ä¸€ä¸ªçš„è¾“å…¥
3. è´¨é‡è¦æ±‚é«˜ï¼Œéœ€è¦é€æ­¥éªŒè¯

**ç¤ºä¾‹åœºæ™¯ï¼š**
```typescript
// åœºæ™¯ï¼šAPI å®‰å…¨åŠ å›ºï¼ˆPipeline ä¸²è¡Œï¼‰
const apiSecurity = {
  title: "REST API å®‰å…¨åŠ å›º",
  mode: "pipeline",
  stages: [
    {
      stage: 1,
      role: "Pentester",
      task: "å¨èƒå»ºæ¨¡ + å®‰å…¨æ–¹æ¡ˆè®¾è®¡",
      output: "å¨èƒæ¨¡å‹ + å®‰å…¨æ–¹æ¡ˆ",
      duration: "4h"
    },
    {
      stage: 2,
      role: "Architect",
      task: "æ¶æ„å®‰å…¨è¯„å®¡",
      input: "å®‰å…¨æ–¹æ¡ˆ",
      output: "è¯„å®¡æ„è§",
      duration: "2h",
      dependencies: [1]
    },
    {
      stage: 3,
      role: "Engineer",
      task: "å®ç°å®‰å…¨ä¸­é—´ä»¶",
      input: "è¯„å®¡åçš„æ–¹æ¡ˆ",
      output: "ä»£ç  + æµ‹è¯•",
      duration: "6h",
      dependencies: [2]
    },
    {
      stage: 4,
      role: "QATester",
      task: "Code Review + å®‰å…¨æµ‹è¯•",
      input: "ä»£ç ",
      output: "æµ‹è¯•æŠ¥å‘Š",
      duration: "4h",
      dependencies: [3]
    }
  ]
};
```

**Pipeline æ‰§è¡Œæµç¨‹ï¼š**
```mermaid
graph LR
    A[Stage 1: Pentester] -->|å¨èƒæ¨¡å‹+æ–¹æ¡ˆ| B[Stage 2: Architect]
    B -->|è¯„å®¡æ„è§| C[Stage 3: Engineer]
    C -->|ä»£ç +æµ‹è¯•| D[Stage 4: QATester]
    D -->|æµ‹è¯•æŠ¥å‘Š| E[ä»»åŠ¡å®Œæˆ]

    style A fill:#ffe1e1
    style B fill:#e1f5ff
    style C fill:#e1ffe1
    style D fill:#fff4e1
```

### 3.2 ä¾èµ–å…³ç³»è¯†åˆ«

#### 3.2.1 ä¾èµ–ç±»å‹

```typescript
enum DependencyType {
  // é¡ºåºä¾èµ–ï¼ˆA å¿…é¡»åœ¨ B ä¹‹å‰å®Œæˆï¼‰
  SEQUENCE = "sequence",

  // æ•°æ®ä¾èµ–ï¼ˆB éœ€è¦ A çš„è¾“å‡ºï¼‰
  DATA = "data",

  // èµ„æºä¾èµ–ï¼ˆA å’Œ B ä¸èƒ½åŒæ—¶ä½¿ç”¨åŒä¸€è§’è‰²ï¼‰
  RESOURCE = "resource",

  // è´¨é‡ä¾èµ–ï¼ˆB éœ€è¦éªŒè¯ A çš„è´¨é‡ï¼‰
  QUALITY = "quality"
}

interface Dependency {
  type: DependencyType;
  from: string; // ä»»åŠ¡ ID
  to: string;   // ä»»åŠ¡ ID
  reason: string;
  blocking: boolean; // æ˜¯å¦é˜»å¡
}
```

#### 3.2.2 è‡ªåŠ¨ä¾èµ–è¯†åˆ«

```typescript
function identifyDependencies(
  task: Task,
  allTasks: Task[]
): Dependency[] {
  const dependencies: Dependency[] = [];

  // 1. é¡ºåºä¾èµ–ï¼ˆåŸºäºä»»åŠ¡ç±»å‹ï¼‰
  if (task.type === "code_review") {
    const implementationTask = allTasks.find(t =>
      t.type === "implementation" && t.status === "completed"
    );
    if (implementationTask) {
      dependencies.push({
        type: DependencyType.QUALITY,
        from: implementationTask.id,
        to: task.id,
        reason: "Code Review éœ€è¦ä»£ç å®ç°å®Œæˆ",
        blocking: true
      });
    }
  }

  // 2. èµ„æºä¾èµ–ï¼ˆåŸºäºè§’è‰²ï¼‰
  const sameRoleTasks = allTasks.filter(t =>
    t.assignee === task.assignee && t.id !== task.id && t.status === "in_progress"
  );
  if (sameRoleTasks.length > 0) {
    sameRoleTasks.forEach(t => {
      dependencies.push({
        type: DependencyType.RESOURCE,
        from: t.id,
        to: task.id,
        reason: `${task.assignee} è§’è‰²æ­£åœ¨æ‰§è¡Œå…¶ä»–ä»»åŠ¡`,
        blocking: true
      });
    });
  }

  // 3. æ•°æ®ä¾èµ–ï¼ˆåŸºäºè¾“å‡ºï¼‰
  if (task.requiredInput) {
    const inputProvider = allTasks.find(t =>
      t.output === task.requiredInput
    );
    if (inputProvider) {
      dependencies.push({
        type: DependencyType.DATA,
        from: inputProvider.id,
        to: task.id,
        reason: `éœ€è¦ ${inputProvider.title} çš„è¾“å‡º`,
        blocking: true
      });
    }
  }

  return dependencies;
}
```

### 3.3 å†²çªæ£€æµ‹ä¸è§£å†³

#### 3.3.1 å†²çªç±»å‹

| å†²çªç±»å‹ | æè¿° | æ£€æµ‹æ–¹æ³• | è§£å†³ç­–ç•¥ |
|---------|------|---------|---------|
| **èµ„æºå†²çª** | å¤šä¸ªä»»åŠ¡éœ€è¦åŒä¸€è§’è‰² | æ£€æŸ¥ TaskList ä¸­ç›¸åŒ assignee | ä¼˜å…ˆçº§æ’åºï¼ˆP0 > P1 > P2 > P3ï¼‰ |
| **ä¾èµ–å†²çª** | å¾ªç¯ä¾èµ– | æ£€æŸ¥ TaskList çš„ dependencies å½¢æˆç¯ | è°ƒæ•´ä»»åŠ¡é¡ºåºæˆ–åˆå¹¶ä»»åŠ¡ |
| **ä¼˜å…ˆçº§å†²çª** | å¤šä¸ª P0 ä»»åŠ¡ | P0 ä»»åŠ¡æ•° > è§’è‰²å¯ç”¨æ•° | è¯„ä¼°ç´§æ€¥ç¨‹åº¦ï¼Œä¸²è¡Œæ‰§è¡Œ |
| **è¾“å‡ºå†²çª** | å¤šä¸ªä»»åŠ¡ä¿®æ”¹åŒä¸€æ–‡ä»¶ | æ£€æŸ¥ codeFiles é‡å  | åŠ é”æˆ–åˆå¹¶ä»»åŠ¡ |

#### 3.3.2 è‡ªåŠ¨å†²çªæ£€æµ‹

```typescript
interface Conflict {
  type: string;
  tasks: string[]; // å†²çªçš„ä»»åŠ¡ ID
  description: string;
  severity: 'low' | 'medium' | 'high';
  resolution?: string;
}

function detectConflicts(tasks: Task[]): Conflict[] {
  const conflicts: Conflict[] = [];

  // 1. èµ„æºå†²çªæ£€æµ‹
  const roleGroups = groupBy(tasks, 'assignee');
  for (const [role, roleTasks] of Object.entries(roleGroups)) {
    if (roleTasks.length > 1) {
      conflicts.push({
        type: "resource",
        tasks: roleTasks.map(t => t.id),
        description: `${role} è§’è‰²è¢«å¤šä¸ªä»»åŠ¡å ç”¨`,
        severity: roleTasks.some(t => t.priority === 'P0') ? 'high' : 'medium',
        resolution: `æŒ‰ä¼˜å…ˆçº§æ’åºï¼š${roleTasks.sort(byPriority).map(t => t.id).join(' â†’ ')}`
      });
    }
  }

  // 2. ä¾èµ–å†²çªæ£€æµ‹ï¼ˆå¾ªç¯ä¾èµ–ï¼‰
  const graph = buildDependencyGraph(tasks);
  const cycles = detectCycles(graph);
  if (cycles.length > 0) {
    cycles.forEach(cycle => {
      conflicts.push({
        type: "dependency",
        tasks: cycle,
        description: `æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–ï¼š${cycle.join(' â†’ ')}`,
        severity: 'high',
        resolution: "è°ƒæ•´ä»»åŠ¡é¡ºåºæˆ–åˆå¹¶ä»»åŠ¡"
      });
    });
  }

  // 3. è¾“å‡ºå†²çªæ£€æµ‹
  const fileGroups = groupBy(tasks.flatMap(t => t.codeFiles || []));
  for (const [file, fileTasks] of Object.entries(fileGroups)) {
    if (fileTasks.length > 1) {
      conflicts.push({
        type: "output",
        tasks: fileTasks.map(t => t.id),
        description: `å¤šä¸ªä»»åŠ¡ä¿®æ”¹åŒä¸€æ–‡ä»¶ï¼š${file}`,
        severity: 'medium',
        resolution: "åŠ é”æˆ–åˆå¹¶ä»»åŠ¡"
      });
    }
  }

  return conflicts;
}
```

#### 3.3.3 å†²çªè§£å†³ç­–ç•¥

**ç­–ç•¥ 1ï¼šä¼˜å…ˆçº§æ’åº**
```typescript
function resolveByPriority(conflicts: Conflict[]): Task[] {
  const sortedTasks = tasks.sort((a, b) => {
    const priorityOrder = { 'P0': 0, 'P1': 1, 'P2': 2, 'P3': 3 };
    return priorityOrder[a.priority] - priorityOrder[b.priority];
  });

  return sortedTasks;
}
```

**ç­–ç•¥ 2ï¼šä»»åŠ¡åˆå¹¶**
```typescript
function mergeTasks(tasks: Task[]): Task {
  return {
    id: generateId(),
    title: `åˆå¹¶ä»»åŠ¡ï¼š${tasks.map(t => t.title).join(' + ')}`,
    description: tasks.map(t => t.description).join('\n'),
    assignee: tasks[0].assignee, // ä½¿ç”¨ç¬¬ä¸€ä¸ªä»»åŠ¡çš„è§’è‰²
    priority: getHighestPriority(tasks),
    dependencies: mergeDependencies(tasks),
    codeFiles: mergeCodeFiles(tasks)
  };
}
```

**ç­–ç•¥ 3ï¼šä¸²è¡Œæ‰§è¡Œ**
```typescript
function serializeTasks(tasks: Task[]): Task[] {
  // é‡æ–°è®¾ç½®ä¾èµ–å…³ç³»ï¼Œä½¿å…¶ä¸²è¡Œæ‰§è¡Œ
  const serialized = [];
  for (let i = 0; i < tasks.length; i++) {
    const task = tasks[i];
    if (i > 0) {
      task.dependencies = [tasks[i - 1].id];
    }
    serialized.push(task);
  }
  return serialized;
}
```

---

## 4. å†²çªè§£å†³æµç¨‹

### 4.1 å†²çªè¯†åˆ«ä¸æŠ¥å‘Š

#### 4.1.1 å®æ—¶ç›‘æ§

**Coordinator èŒè´£ï¼š**
1. æŒç»­ç›‘æ§ TaskList çŠ¶æ€
2. æ£€æµ‹æ–°äº§ç”Ÿçš„å†²çª
3. è¯„ä¼°å†²çªä¸¥é‡ç¨‹åº¦
4. è§¦å‘è§£å†³æµç¨‹

**ç›‘æ§æŒ‡æ ‡ï¼š**
```typescript
interface ConflictMonitor {
  // èµ„æºå†²çª
  resourceConflicts: number;        // è§’è‰²å ç”¨å†²çªæ•°
  avgTaskQueueLength: number;       // å¹³å‡ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦

  // ä¾èµ–å†²çª
  circularDependencies: number;     // å¾ªç¯ä¾èµ–æ•°
  blockedTasks: number;             // è¢«é˜»å¡ä»»åŠ¡æ•°

  // ä¼˜å…ˆçº§å†²çª
  p0TaskCount: number;              // P0 ä»»åŠ¡æ•°
  p0TaskOverCapacity: boolean;      // P0 ä»»åŠ¡è¶…å‡ºå®¹é‡

  // è¾“å‡ºå†²çª
  fileConflicts: number;            // æ–‡ä»¶ä¿®æ”¹å†²çªæ•°
}
```

#### 4.1.2 å†²çªæŠ¥å‘Šæ ¼å¼

```markdown
## ğŸ”´ å†²çªæŠ¥å‘Š

**æ—¶é—´ï¼š** YYYY-MM-DD HH:MM:SS
**çº§åˆ«ï¼š** ğŸ”´ é«˜å± / ğŸŸ¡ ä¸­å± / ğŸŸ¢ ä½å±

### å†²çªæè¿°
[å†²çªè¯¦æƒ…]

### å½±å“èŒƒå›´
- å—å½±å“ä»»åŠ¡ï¼š[ä»»åŠ¡åˆ—è¡¨]
- å—å½±å“è§’è‰²ï¼š[è§’è‰²åˆ—è¡¨]
- é¢„è®¡å»¶è¿Ÿï¼š[å°æ—¶]

### å»ºè®®è§£å†³æ–¹æ¡ˆ
- æ–¹æ¡ˆ Aï¼š[æè¿°] - [ä¼˜åŠ£åŠ¿]
- æ–¹æ¡ˆ Bï¼š[æè¿°] - [ä¼˜åŠ£åŠ¿]

### å†³ç­–
[æœ€ç»ˆå†³ç­–]

**è´Ÿè´£äººï¼š** Coordinator
**çŠ¶æ€ï¼š** å¾…è§£å†³ / è§£å†³ä¸­ / å·²è§£å†³
```

### 4.2 å¤šè§’è‰²æ„è§åˆ†æ­§

#### 4.2.1 åˆ†æ­§ç±»å‹

| åˆ†æ­§ç±»å‹ | ç¤ºä¾‹ | å½±å“èŒƒå›´ | è§£å†³æœºåˆ¶ |
|---------|------|---------|---------|
| **æŠ€æœ¯åˆ†æ­§** | Architect å’Œ Engineer å¯¹å®ç°æ–¹æ¡ˆæœ‰åˆ†æ­§ | ä¸­ | Council è®¨è®º + å®éªŒéªŒè¯ |
| **è´¨é‡åˆ†æ­§** | QATester å’Œ Engineer å¯¹æµ‹è¯•è¦†ç›–ç‡è¦æ±‚ä¸ä¸€è‡´ | ä½ | åˆ¶å®šç»Ÿä¸€è´¨é‡æ ‡å‡† |
| **å®‰å…¨åˆ†æ­§** | Pentester å’Œ Architect å¯¹å®‰å…¨æ–¹æ¡ˆæœ‰åˆ†æ­§ | é«˜ | Pentester ä¸€ç¥¨å¦å†³æƒ |
| **ä¼˜å…ˆçº§åˆ†æ­§** | å¤šä¸ªè§’è‰²å¯¹ä»»åŠ¡ä¼˜å…ˆçº§æœ‰ä¸åŒæ„è§ | ä¸­ | Coordinator åè°ƒ |

#### 4.2.2 Council æ¨¡å¼ï¼ˆåˆ†æ­§è§£å†³ï¼‰

**è§¦å‘æ¡ä»¶ï¼š**
- æŠ€æœ¯åˆ†æ­§ä¸”æ— æ³•è¾¾æˆå…±è¯†
- æ¶æ„é‡å¤§å˜æ›´
- P0/P1 å®‰å…¨é£é™©åº”å¯¹
- é‡Œç¨‹ç¢‘æ–¹å‘è°ƒæ•´

**å‚ä¸è§’è‰²ï¼š**
- **æ ¸å¿ƒè§’è‰²**ï¼ˆå¿…é¡»å‚ä¸ï¼‰ï¼šArchitectã€Engineerã€Pentester
- **å’¨è¯¢è§’è‰²**ï¼ˆæŒ‰éœ€å‚ä¸ï¼‰ï¼šQATesterã€Analystã€Researcher
- **åè°ƒè§’è‰²**ï¼šCoordinator

**Council æµç¨‹ï¼š**
```mermaid
graph TD
    A[Coordinator å‘èµ· Council] --> B[å„è§’è‰²å‡†å¤‡è§‚ç‚¹]
    B --> C[è§‚ç‚¹é™ˆè¿°å’Œè¾©è®º]
    C --> D[å¤šæ–¹æ¡ˆå¯¹æ¯”åˆ†æ]
    D --> E[Algorithm ç»„è¯„ä¼°å¯è¡Œæ€§]
    E --> F[ç”¨æˆ·æœ€ç»ˆå†³ç­–]
    F --> G[è®°å½•å†³ç­–åˆ° ADR]
    G --> H[æ‰§è¡Œå†³ç­–]

    style A fill:#fff4e1
    style F fill:#e1ffe1
    style G fill:#e1f5ff
```

**ç¤ºä¾‹ Council è®¨è®ºï¼š**
```markdown
##è®®é¢˜ï¼šæ˜¯å¦é‡‡ç”¨ WebSocket å®ç°å®æ—¶é€šä¿¡ï¼Ÿ

### å‚ä¸è§’è‰²
- Architectï¼ˆä¸»æŒäººï¼‰
- Engineerã€Pentesterã€QATester
- Researcherï¼ˆå’¨è¯¢ï¼‰

### è§‚ç‚¹é™ˆè¿°

**Architect è§‚ç‚¹ï¼š**
- âœ… ä¼˜åŠ¿ï¼šåŸç”Ÿæ”¯æŒã€è½»é‡çº§ã€å®æ—¶æ€§å¥½
- âš ï¸ åŠ£åŠ¿ï¼šå¢åŠ å¤æ‚åº¦ã€éœ€è¦å¿ƒè·³æœºåˆ¶ã€é”™è¯¯å¤„ç†å¤æ‚
- ğŸ“Š æˆæœ¬ï¼š2 å‘¨å¼€å‘æ—¶é—´

**Pentester è§‚ç‚¹ï¼š**
- âš ï¸ å®‰å…¨é£é™©ï¼šWebSocket è¿æ¥æ˜“å—åŠ«æŒæ”»å‡»
- âœ… ç¼“è§£æªæ–½ï¼šä½¿ç”¨ WSSï¼ˆTLS åŠ å¯†ï¼‰ã€Origin éªŒè¯ã€é€Ÿç‡é™åˆ¶
- ğŸ“Š æˆæœ¬ï¼šå¢åŠ  3 å¤©å®‰å…¨åŠ å›ºå·¥ä½œ

**Engineer è§‚ç‚¹ï¼š**
- âœ… å®ç°å¯è¡Œï¼šä½¿ç”¨ ws åº“æˆ– Hono WS
- âš ï¸ å¤æ‚åº¦ï¼šéœ€è¦ç®¡ç†è¿æ¥æ± ã€é‡è¿æœºåˆ¶ã€æ¶ˆæ¯é˜Ÿåˆ—
- ğŸ“Š æˆæœ¬ï¼š1.5 å‘¨å¼€å‘ + 3 å¤©æµ‹è¯•

**QATester è§‚ç‚¹ï¼š**
- âš ï¸ æµ‹è¯•æŒ‘æˆ˜ï¼šWebSocket æµ‹è¯•éœ€è¦ä¸“ç”¨å·¥å…·ï¼ˆå¦‚ Autobahnï¼‰
- âœ… è´¨é‡ä¿éšœï¼šç¼–å†™é›†æˆæµ‹è¯•ã€æ¨¡æ‹Ÿå¹¶å‘è¿æ¥
- ğŸ“Š æˆæœ¬ï¼š1 å‘¨æµ‹è¯•å·¥ä½œ

**Researcher è¡¥å……ï¼š**
- æä¾› SSEï¼ˆServer-Sent Eventsï¼‰ä½œä¸ºæŠ˜ä¸­æ–¹æ¡ˆ
- SSE ä¼˜åŠ¿ï¼šåŸºäº HTTPã€å®ç°ç®€å•ã€å•å‘æ¨é€
- SSE åŠ£åŠ¿ï¼šä¸æ”¯æŒåŒå‘é€šä¿¡

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æˆæœ¬ | é£é™© |
|------|------|------|------|------|
| A: WebSocket | å®æ—¶æ€§æœ€å¥½ | å¤æ‚åº¦é«˜ | 3-4 å‘¨ | é«˜ |
| B: è½®è¯¢ | ç®€å•å¯é  | å®æ—¶æ€§å·® | 1 å‘¨ | ä½ |
| C: SSE | æŠ˜ä¸­æ–¹æ¡ˆ | å•å‘æ¨é€ | 1 å‘¨ | ä¸­ |

### Algorithm ç»„è¯„ä¼°
- âœ… æŠ€æœ¯å¯è¡Œæ€§ï¼šé«˜ï¼ˆæˆç†ŸæŠ€æœ¯æ ˆï¼‰
- âš ï¸ æ—¶é—´æˆæœ¬ï¼š3-4 å‘¨ï¼ˆè¶…å‡ºåŸè®¡åˆ’ï¼‰
- âš ï¸ èµ„æºéœ€æ±‚ï¼šéœ€è¦é¢å¤–æµ‹è¯•ç¯å¢ƒ

### ç”¨æˆ·å†³ç­–
**é€‰æ‹©æ–¹æ¡ˆ Cï¼ˆSSEï¼‰**

**ç†ç”±ï¼š**
1. æ»¡è¶³éœ€æ±‚ï¼ˆå•å‘æ¨é€å‘Šè­¦é€šçŸ¥ï¼‰
2. å¤æ‚åº¦å¯æ§ï¼ˆ1 å‘¨å®ç°ï¼‰
3. å‘åå…¼å®¹ï¼ˆåŸºäº HTTPï¼‰

### å†³ç­–è¾“å‡º
- ADR-003: é‡‡ç”¨ SSE å®ç°å®æ—¶é€šçŸ¥
- æ›´æ–°æ¶æ„æ–‡æ¡£ï¼ˆPhase 2.3ï¼šScheduler + Notifierï¼‰
- åˆ†é…ä»»åŠ¡ç»™ Engineer
```

### 4.3 ä»£ç å†²çªè‡ªåŠ¨åˆå¹¶

#### 4.3.1 é¢„é˜²ç­–ç•¥

**ç­–ç•¥ 1ï¼šæ–‡ä»¶é”å®š**
```typescript
// æ–‡ä»¶é”å®šæœºåˆ¶
interface FileLock {
  acquire(filePath: string, taskId: string): Promise<boolean>;
  release(filePath: string, taskId: string): Promise<void>;
  isLocked(filePath: string): Promise<boolean>;
}

// ä½¿ç”¨ç¤ºä¾‹
const lock = new FileLock();

// ä»»åŠ¡å¼€å§‹å‰å°è¯•è·å–é”
const acquired = await lock.acquire('src/api/server.ts', taskId);
if (!acquired) {
  throw new Error(`æ–‡ä»¶ ${filePath} å·²è¢«å…¶ä»–ä»»åŠ¡é”å®š`);
}

try {
  // æ‰§è¡Œä»»åŠ¡
  await executeTask(task);
} finally {
  // é‡Šæ”¾é”
  await lock.release('src/api/server.ts', taskId);
}
```

**ç­–ç•¥ 2ï¼šä»»åŠ¡åˆ†åŒº**
```typescript
// æŒ‰æ¨¡å—åˆ†åŒºä»»åŠ¡
const taskPartitioning = {
  "API æ¨¡å—": {
    tasks: ["Task-1", "Task-2", "Task-3"],
    assignee: "Engineer-A",
    files: ["src/api/*.ts"]
  },
  "Core æ¨¡å—": {
    tasks: ["Task-4", "Task-5"],
    assignee: "Engineer-B",
    files: ["src/core/*.ts"]
  }
};
```

**ç­–ç•¥ 3ï¼šå¢é‡åˆå¹¶**
```typescript
// Git åˆ†æ”¯ç­–ç•¥
const gitWorkflow = {
  main: "main",
  branches: {
    feature: "feature/task-XXX",
    hotfix: "hotfix/security-XXX"
  },
  mergeStrategy: {
    feature: "squash and merge",
    hotfix: "merge commit"
  }
};
```

#### 4.3.2 è‡ªåŠ¨åˆå¹¶ç®—æ³•

```typescript
interface MergeResult {
  success: boolean;
  conflicts?: Conflict[];
  mergedContent?: string;
}

async function autoMerge(
  file: string,
  changes: Change[]
): Promise<MergeResult> {
  // 1. è¯»å–åŸå§‹å†…å®¹
  const original = await readFile(file);

  // 2. å°è¯•è‡ªåŠ¨åˆå¹¶
  const merged = await mergeChanges(original, changes);

  // 3. æ£€æµ‹å†²çª
  if (merged.hasConflicts) {
    return {
      success: false,
      conflicts: merged.conflicts
    };
  }

  // 4. éªŒè¯åˆå¹¶ç»“æœ
  const isValid = await validateMerge(merged.content);
  if (!isValid) {
    return {
      success: false,
      conflicts: [{
        type: "validation",
        message: "åˆå¹¶ç»“æœéªŒè¯å¤±è´¥"
      }]
    };
  }

  return {
    success: true,
    mergedContent: merged.content
  };
}
```

### 4.4 ä¼˜å…ˆçº§å†²çªåè°ƒ

#### 4.4.1 ä¼˜å…ˆçº§è¯„ä¼°çŸ©é˜µ

```typescript
interface PriorityMatrix {
  task: string;
  urgency: number;  // ç´§æ€¥ç¨‹åº¦ï¼ˆ0-10ï¼‰
  impact: number;   // å½±å“èŒƒå›´ï¼ˆ0-10ï¼‰
  effort: number;   // å·¥ä½œé‡ï¼ˆ0-10ï¼Œè¶Šå°è¶Šå®¹æ˜“ï¼‰
  priority: number; // ç»¼åˆä¼˜å…ˆçº§
}

function calculatePriority(matrix: PriorityMatrix): number {
  // ä¼˜å…ˆçº§ = (ç´§æ€¥ç¨‹åº¦ * 0.4 + å½±å“èŒƒå›´ * 0.4) / å·¥ä½œé‡
  return ((matrix.urgency * 0.4 + matrix.impact * 0.4) / matrix.effort) * 10;
}

// ç¤ºä¾‹
const tasks = [
  {
    task: "SQL æ³¨å…¥æ¼æ´ä¿®å¤",
    urgency: 10, // æå…¶ç´§æ€¥
    impact: 10,  // å½±å“é‡å¤§
    effort: 5,   // ä¸­ç­‰å·¥ä½œé‡
    priority: calculatePriority({ urgency: 10, impact: 10, effort: 5 }) // 16
  },
  {
    task: "API æ–‡æ¡£æ›´æ–°",
    urgency: 3,  // ä¸ç´§æ€¥
    impact: 5,   // å½±å“ä¸­ç­‰
    effort: 2,   // å·¥ä½œé‡å°
    priority: calculatePriority({ urgency: 3, impact: 5, effort: 2 }) // 16
  }
];
```

#### 4.4.2 åŠ¨æ€ä¼˜å…ˆçº§è°ƒæ•´

```typescript
function adjustPriority(
  task: Task,
  context: ProjectContext
): Priority {
  let adjustedPriority = task.priority;

  // 1. æ—¶é—´æ•æ„Ÿåº¦è°ƒæ•´
  const daysUntilDeadline = getDaysUntil(task.deadline);
  if (daysUntilDeadline <= 1 && task.priority !== 'P0') {
    adjustedPriority = elevatePriority(adjustedPriority); // æå‡ä¸€çº§
  }

  // 2. ä¾èµ–é˜»å¡è°ƒæ•´
  const blockingTasks = getBlockingTasks(task.id);
  if (blockingTasks.length > 0) {
    adjustedPriority = elevatePriority(adjustedPriority); // æå‡ä¸€çº§
  }

  // 3. èµ„æºå¯ç”¨æ€§è°ƒæ•´
  const assigneeAvailable = isRoleAvailable(task.assignee);
  if (!assigneeAvailable) {
    adjustedPriority = lowerPriority(adjustedPriority); // é™ä½ä¸€çº§
  }

  return adjustedPriority;
}
```

---

## 5. é€šä¿¡åè®®

### 5.1 è§’è‰²é—´æ¶ˆæ¯ä¼ é€’

#### 5.1.1 æ¶ˆæ¯æ ¼å¼

```typescript
interface RoleMessage {
  id: string;
  from: string;        // å‘é€è€…è§’è‰²
  to: string | string[]; // æ¥æ”¶è€…è§’è‰²
  timestamp: string;
  type: MessageType;
  priority: 'low' | 'medium' | 'high' | 'urgent';
  subject: string;
  body: string;
  attachments?: Attachment[];
  metadata?: {
    taskId?: string;
    relatedFiles?: string[];
    requiresResponse?: boolean;
    responseDeadline?: string;
  };
}

enum MessageType {
  // ä»»åŠ¡ç›¸å…³
  TASK_ASSIGN = "task_assign",
  TASK_UPDATE = "task_update",
  TASK_COMPLETE = "task_complete",
  TASK_BLOCKED = "task_blocked",

  // åä½œç›¸å…³
  COLLABORATION_REQUEST = "collaboration_request",
  COLLABORATION_RESPONSE = "collaboration_response",
  FEEDBACK = "feedback",
  QUESTION = "question",

  // å†³ç­–ç›¸å…³
  DECISION_REQUEST = "decision_request",
  DECISION_NOTICE = "decision_notice",
  COUNCIL_INVITATION = "council_invitation",

  // è´¨é‡ç›¸å…³
  REVIEW_REQUEST = "review_request",
  REVIEW_COMMENT = "review_comment",
  ISSUE_REPORT = "issue_report",

  // ç´§æ€¥ç›¸å…³
  EMERGENCY_ALERT = "emergency_alert",
  ESCALATION = "escalation"
}
```

#### 5.1.2 æ¶ˆæ¯ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼šä»»åŠ¡åˆ†é…**
```typescript
const taskAssignMessage: RoleMessage = {
  id: "MSG-2026-0501",
  from: "Coordinator",
  to: "Pentester",
  timestamp: "2026-02-05T09:00:00Z",
  type: MessageType.TASK_ASSIGN,
  priority: "urgent",
  subject: "P0 ä»»åŠ¡ï¼šREST API å®‰å…¨åŠ å›º",
  body: `
## ä»»åŠ¡æè¿°
ä¸º ReflectGuard REST API æ·»åŠ è®¤è¯ã€éªŒè¯å’Œé™æµæœºåˆ¶

## ä¼˜å…ˆçº§
P0ï¼ˆä¸¥é‡ï¼‰- ç«‹å³å¼€å§‹

## æˆªæ­¢æ—¶é—´
2026-02-07 18:00

## ä½ éœ€è¦åšçš„
1. STRIDE å¨èƒå»ºæ¨¡
2. è®¾è®¡å®‰å…¨æ–¹æ¡ˆï¼ˆè®¤è¯ + éªŒè¯ + é™æµï¼‰
3. ç¼–å†™å®‰å…¨æµ‹è¯•ç”¨ä¾‹

## åä½œä¼™ä¼´
- Architectï¼šæ¶æ„è¯„å®¡
- Engineerï¼šä»£ç å®ç°
- QATesterï¼šæµ‹è¯•éªŒè¯

è¯·ç¡®è®¤æ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚
  `,
  metadata: {
    taskId: "TASK-2026-0501",
    requiresResponse: true,
    responseDeadline: "2026-02-05T10:00:00Z"
  }
};
```

**ç¤ºä¾‹ 2ï¼šCode Review åé¦ˆ**
```typescript
const reviewCommentMessage: RoleMessage = {
  id: "MSG-2026-0502",
  from: "QATester",
  to: "Engineer",
  timestamp: "2026-02-06T16:30:00Z",
  type: MessageType.REVIEW_COMMENT,
  priority: "high",
  subject: "Code Reviewï¼šAPI è®¤è¯ä¸­é—´ä»¶",
  body: `
## Review ç»“æœï¼šéœ€è¦ä¿®æ”¹

### âœ… åšå¾—å¥½çš„åœ°æ–¹
- TypeScript ä¸¥æ ¼æ¨¡å¼é€šè¿‡
- TSDoc æ³¨é‡Šå®Œæ•´
- é”™è¯¯å¤„ç†è€ƒè™‘å‘¨å…¨

### âš ï¸ éœ€è¦æ”¹è¿›çš„é—®é¢˜

#### 1. å®‰å…¨é—®é¢˜ï¼ˆP1ï¼‰
**ä½ç½®ï¼š** src/api/middleware/auth.ts:45
**é—®é¢˜ï¼š** API Key æœªéªŒè¯å¼ºåº¦
**å»ºè®®ï¼š** æ·»åŠ æœ€å°é•¿åº¦å’Œå¤æ‚åº¦æ£€æŸ¥

\`\`\`typescript
// å½“å‰ä»£ç 
if (!apiKey) {
  throw new UnauthorizedError('Missing API Key');
}

// å»ºè®®ä¿®æ”¹
if (!apiKey || apiKey.length < 32 || !/^[a-zA-Z0-9]+$/.test(apiKey)) {
  throw new UnauthorizedError('Invalid API Key');
}
\`\`\`

#### 2. æ€§èƒ½é—®é¢˜ï¼ˆP2ï¼‰
**ä½ç½®ï¼š** src/api/middleware/auth.ts:78
**é—®é¢˜ï¼š** æ¯æ¬¡è¯·æ±‚éƒ½è¯»å–é…ç½®æ–‡ä»¶
**å»ºè®®ï¼š** ç¼“å­˜é…ç½®ï¼Œé¿å…é¢‘ç¹ I/O

\`\`\`typescript
// å½“å‰ä»£ç 
const config = await readFile('./config/api-keys.json');

// å»ºè®®ä¿®æ”¹
const config = await getConfigCache(); // ä½¿ç”¨ç¼“å­˜
\`\`\`

### ğŸ“Š è´¨é‡æŒ‡æ ‡
- ä»£ç è¦†ç›–ç‡ï¼š87% âœ…ï¼ˆç›®æ ‡ >85%ï¼‰
- åœˆå¤æ‚åº¦ï¼š8 âœ…ï¼ˆç›®æ ‡ <10ï¼‰
- æ€§èƒ½æµ‹è¯•ï¼šé€šè¿‡ âœ…

### ä¸‹ä¸€æ­¥
è¯·åœ¨ 2026-02-07 12:00 å‰ä¿®å¤ä¸Šè¿°é—®é¢˜ï¼Œç„¶åæäº¤é‡æ–°å®¡æŸ¥ã€‚
  `,
  attachments: [
    {
      type: "code_review_report",
      url: "./reports/code-review-TASK-2026-0502.md"
    }
  ],
  metadata: {
    taskId: "TASK-2026-0502",
    relatedFiles: ["src/api/middleware/auth.ts"],
    requiresResponse: true,
    responseDeadline: "2026-02-07T12:00:00Z"
  }
};
```

**ç¤ºä¾‹ 3ï¼šç´§æ€¥å‘Šè­¦**
```typescript
const emergencyAlertMessage: RoleMessage = {
  id: "MSG-2026-0503",
  from: "Pentester",
  to: ["Coordinator", "Architect", "Engineer"],
  timestamp: "2026-02-07T14:30:00Z",
  type: MessageType.EMERGENCY_ALERT,
  priority: "urgent",
  subject: "ğŸš¨ å‘ç° SQL æ³¨å…¥æ¼æ´",
  body: `
## ğŸš¨ ä¸¥é‡å®‰å…¨æ¼æ´

### æ¼æ´è¯¦æƒ…
- **ç±»å‹ï¼š** SQL æ³¨å…¥
- **ä½ç½®ï¼š** src/api/routes/gateway.ts:123
- **ä¸¥é‡çº§åˆ«ï¼š** P0ï¼ˆé«˜å±ï¼‰

### æ¼æ´æè¿°
Gateway æ£€æŸ¥æ¥å£çš„ intent å‚æ•°æœªåšè¾“å…¥éªŒè¯ï¼Œç›´æ¥æ‹¼æ¥åˆ° SQL æŸ¥è¯¢ä¸­ï¼Œå¯¼è‡´ SQL æ³¨å…¥æ¼æ´ã€‚

### æ”»å‡»åœºæ™¯
\`\`\`
curl -X POST http://localhost:3000/api/v1/gateway/check \\
  -H "Content-Type: application/json" \\
  -d '{"intent": "'; DROP TABLE violations; --"}'
\`\`\`

### ç«‹å³è¡ŒåŠ¨
1. **Pentesterï¼š** åˆ†ææ¼æ´å½±å“èŒƒå›´
2. **Architectï¼š** è®¾è®¡ä¿®å¤æ–¹æ¡ˆ
3. **Engineerï¼š** ç«‹å³ä¿®å¤æ¼æ´
4. **QATesterï¼š** ç¼–å†™å›å½’æµ‹è¯•

### é¢„è®¡å®Œæˆæ—¶é—´
2026-02-07 18:00ï¼ˆ3.5 å°æ—¶å†…ï¼‰

è¯·ç«‹å³åœæ­¢æ‰€æœ‰å…¶ä»–ä»»åŠ¡ï¼Œå…¨åŠ›ä¿®å¤æ­¤æ¼æ´ã€‚
  `,
  metadata: {
    taskId: "TASK-2026-0503",
    requiresResponse: true,
    responseDeadline: "2026-02-07T14:45:00Z" // 15 åˆ†é’Ÿå†…å›å¤
  }
};
```

### 5.2 å…±äº«ä¸Šä¸‹æ–‡æ›´æ–°

#### 5.2.1 ä¸Šä¸‹æ–‡æ›´æ–°è§¦å‘æ¡ä»¶

| è§¦å‘æ¡ä»¶ | æ›´æ–°å†…å®¹ | æ›´æ–°é¢‘ç‡ | é€šçŸ¥è§’è‰² |
|---------|---------|---------|---------|
| **ä»£ç å˜æ›´** | Git commitã€PR merge | å®æ—¶ | æ‰€æœ‰ç›¸å…³è§’è‰² |
| **å†³ç­–è®°å½•** | ADR åˆ›å»ºã€DECISION æ›´æ–° | æŒ‰éœ€ | æ‰€æœ‰è§’è‰² |
| **ä»»åŠ¡å®Œæˆ** | Task çŠ¶æ€æ›´æ–°ä¸º completed | å®æ—¶ | Coordinator + ä¸‹æ¸¸è§’è‰² |
| **æ–‡æ¡£æ›´æ–°** | API æ–‡æ¡£ã€README å˜æ›´ | æŒ‰éœ€ | æ‰€æœ‰è§’è‰² |
| **çŸ¥è¯†åº“æ›´æ–°** | æœ€ä½³å®è·µã€æ¡ˆä¾‹åº“æ›´æ–° | æ¯å‘¨ | æ‰€æœ‰è§’è‰² |

#### 5.2.2 ä¸Šä¸‹æ–‡æ›´æ–°åè®®

```typescript
interface ContextUpdate {
  id: string;
  timestamp: string;
  type: ContextUpdateType;
  source: string; // è§¦å‘æ›´æ–°çš„è§’è‰²
  content: {
    documents: string[];     // æ›´æ–°çš„æ–‡æ¡£åˆ—è¡¨
    codeFiles?: string[];    // æ›´æ–°çš„ä»£ç æ–‡ä»¶
    decisions?: string[];    // æ›´æ–°çš„å†³ç­–
    tasks?: string[];        // æ›´æ–°çš„ä»»åŠ¡
  };
  impact: {
    affectedRoles: string[]; // å—å½±å“çš„è§’è‰²
    actionRequired: boolean; // æ˜¯å¦éœ€è¦è¡ŒåŠ¨
  };
}

enum ContextUpdateType {
  CODE_CHANGE = "code_change",
  DECISION_MADE = "decision_made",
  DOCUMENT_UPDATED = "document_updated",
  TASK_COMPLETED = "task_completed",
  KNOWLEDGE_ADDED = "knowledge_added"
}

// ç¤ºä¾‹ä¸Šä¸‹æ–‡æ›´æ–°
const contextUpdate: ContextUpdate = {
  id: "CTX-2026-0501",
  timestamp: "2026-02-06T18:00:00Z",
  type: ContextUpdateType.CODE_CHANGE,
  source: "Engineer",
  content: {
    documents: ["api/CLAUDE.md"],
    codeFiles: ["src/api/middleware/auth.ts", "src/api/routes/gateway.ts"],
    tasks: ["TASK-2026-0502"]
  },
  impact: {
    affectedRoles: ["QATester", "Pentester", "Writer"],
    actionRequired: true
  }
};
```

#### 5.2.3 å¢é‡æ›´æ–°ç­–ç•¥

**ç­–ç•¥ï¼š**
1. **æœ€å°åŒ–æ›´æ–°** - åªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†
2. **ç‰ˆæœ¬æ§åˆ¶** - æ¯æ¬¡æ›´æ–°éƒ½æœ‰ç‰ˆæœ¬å·
3. **å¢é‡åŒæ­¥** - è§’è‰²åªåŒæ­¥éœ€è¦çš„éƒ¨åˆ†
4. **ç¼“å­˜æœºåˆ¶** - ç¼“å­˜å¸¸ç”¨ä¸Šä¸‹æ–‡

```typescript
interface ContextCache {
  get(key: string): Promise<any>;
  set(key: string, value: any, ttl?: number): Promise<void>;
  invalidate(pattern: string): Promise<void>;
}

// ä¸Šä¸‹æ–‡ç¼“å­˜ä½¿ç”¨
const cache = new ContextCache();

// Engineer æ¿€æ´»æ—¶åŠ è½½ä¸Šä¸‹æ–‡
async function loadContextForEngineer(role: string): Promise<RoleContext> {
  // 1. å°è¯•ä»ç¼“å­˜è·å–
  const cached = await cache.get(`context:${role}`);
  if (cached && !isStale(cached)) {
    return cached;
  }

  // 2. ä»æ–‡æ¡£åŠ è½½
  const context = await loadContextFromDocuments(role);

  // 3. ç¼“å­˜ç»“æœï¼ˆTTL 5 åˆ†é’Ÿï¼‰
  await cache.set(`context:${role}`, context, 300);

  return context;
}

// ä¸Šä¸‹æ–‡æ›´æ–°æ—¶å¤±æ•ˆç¼“å­˜
async function onContextUpdate(update: ContextUpdate): Promise<void> {
  // 1. å¤±æ•ˆç›¸å…³ç¼“å­˜
  await cache.invalidate(`context:*`);

  // 2. é€šçŸ¥å—å½±å“è§’è‰²
  for (const role of update.impact.affectedRoles) {
    await notifyRole(role, {
      type: "context_update",
      update: update.id
    });
  }
}
```

### 5.3 çŠ¶æ€åŒæ­¥æœºåˆ¶

#### 5.3.1 å¿ƒè·³æœºåˆ¶

```typescript
interface Heartbeat {
  roleId: string;
  timestamp: string;
  status: 'idle' | 'busy' | 'blocked';
  currentTask?: string;
  message?: string;
}

// æ¯ä¸ªè§’è‰²å®šæœŸå‘é€å¿ƒè·³
async function sendHeartbeat(role: string, heartbeat: Heartbeat): Promise<void> {
  await messageBus.publish(`heartbeat:${role}`, heartbeat);
}

// Coordinator ç›‘å¬æ‰€æœ‰è§’è‰²å¿ƒè·³
async function monitorRoles(): Promise<void> {
  const roles = ["Architect", "Engineer", "Pentester", "QATester", "Analyst", "Writer"];

  for (const role of roles) {
    messageBus.subscribe(`heartbeat:${role}`, (heartbeat: Heartbeat) => {
      console.log(`[${role}] ${heartbeat.status} - ${heartbeat.message || 'æ— æ¶ˆæ¯'}`);

      // æ£€æµ‹è§’è‰²æ˜¯å¦è¢«é˜»å¡
      if (heartbeat.status === 'blocked') {
        handleBlockedRole(role, heartbeat);
      }
    });
  }
}

// å¤„ç†è¢«é˜»å¡çš„è§’è‰²
async function handleBlockedRole(role: string, heartbeat: Heartbeat): Promise<void> {
  console.warn(`âš ï¸ è§’è‰² ${role} è¢«é˜»å¡ï¼š${heartbeat.message}`);

  // é€šçŸ¥ Coordinator
  await notifyCoordinator({
    type: "role_blocked",
    role: role,
    task: heartbeat.currentTask,
    reason: heartbeat.message
  });

  // å°è¯•è§£å†³é˜»å¡
  await resolveBlock(role, heartbeat.currentTask);
}
```

#### 5.3.2 çŠ¶æ€å¹¿æ’­

```typescript
// é‡è¦çŠ¶æ€å˜æ›´å¹¿æ’­
async function broadcastStateChange(change: StateChange): Promise<void> {
  const message = {
    type: "state_change",
    change: change
  };

  // å¹¿æ’­ç»™æ‰€æœ‰è§’è‰²
  await messageBus.publish("broadcast:state", message);
}

// ç¤ºä¾‹ï¼šP0 ä»»åŠ¡å¯åŠ¨å¹¿æ’­
await broadcastStateChange({
  type: "p0_task_started",
  taskId: "TASK-2026-0501",
  priority: "P0",
  message: "æ‰€æœ‰é P0 ä»»åŠ¡æš‚åœï¼Œå…¨åŠ›æ”¯æŒ P0 ä»»åŠ¡",
  affectedTasks: allTasks.filter(t => t.priority !== "P0").map(t => t.id)
});
```

---

## 6. è´¨é‡ä¿è¯é›†æˆ

### 6.1 è´¨é‡æ£€æŸ¥ç‚¹

#### 6.1.1 æ£€æŸ¥ç‚¹åˆ†å¸ƒ

```mermaid
graph LR
    A[ä»»åŠ¡åˆ†é…] --> B[è®¾è®¡è¯„å®¡]
    B --> C[å®ç°]
    C --> D[å•å…ƒæµ‹è¯•]
    D --> E[Code Review]
    E --> F[é›†æˆæµ‹è¯•]
    F --> G[å®‰å…¨æµ‹è¯•]
    G --> H[æ€§èƒ½æµ‹è¯•]
    H --> I[éªŒæ”¶]

    style B fill:#e1f5ff
    style E fill:#fff4e1
    style G fill:#ffe1e1
    style I fill:#e1ffe1
```

**æ£€æŸ¥ç‚¹å®šä¹‰ï¼š**

| æ£€æŸ¥ç‚¹ | è´Ÿè´£è§’è‰² | æ£€æŸ¥å†…å®¹ | é€šè¿‡æ ‡å‡† |
|--------|---------|---------|---------|
| **è®¾è®¡è¯„å®¡** | Architect | æ¶æ„åˆç†æ€§ã€æŠ€æœ¯é€‰å‹ã€æ‰©å±•æ€§ | ADR æ‰¹å‡† |
| **å•å…ƒæµ‹è¯•** | Engineer | ä»£ç é€»è¾‘ã€è¾¹ç•Œæ¡ä»¶ã€é”™è¯¯å¤„ç† | è¦†ç›–ç‡ >85% |
| **Code Review** | QATester | ä»£ç è´¨é‡ã€å‘½åè§„èŒƒã€æ³¨é‡Šå®Œæ•´æ€§ | Review é€šè¿‡ |
| **é›†æˆæµ‹è¯•** | QATester | æ¨¡å—åä½œã€æ•°æ®æµã€æ¥å£å¥‘çº¦ | æµ‹è¯•é€šè¿‡ |
| **å®‰å…¨æµ‹è¯•** | Pentester | OWASP Top 10ã€STRIDE å¨èƒ | æ— é«˜å±æ¼æ´ |
| **æ€§èƒ½æµ‹è¯•** | QATester + Analyst | å“åº”æ—¶é—´ã€ååé‡ã€èµ„æºä½¿ç”¨ | è¾¾åˆ°æ€§èƒ½ç›®æ ‡ |
| **éªŒæ”¶** | Coordinator | åŠŸèƒ½å®Œæ•´æ€§ã€æ–‡æ¡£å®Œæ•´æ€§ | éªŒæ”¶æ ‡å‡†æ»¡è¶³ |

#### 6.1.2 è´¨é‡é—¨ç¦

```typescript
interface QualityGate {
  name: string;
  criteria: QualityCriteria[];
  required: boolean; // æ˜¯å¦å¿…é¡»é€šè¿‡
  role: string;      // è´Ÿè´£è§’è‰²
}

interface QualityCriteria {
  metric: string;
  threshold: number | boolean;
  actual: number | boolean;
  passed: boolean;
  message?: string;
}

// è´¨é‡é—¨ç¦ç¤ºä¾‹
const qualityGates: QualityGate[] = [
  {
    name: "ä»£ç è´¨é‡é—¨ç¦",
    required: true,
    role: "QATester",
    criteria: [
      { metric: "test_coverage", threshold: 0.85, actual: 0.87, passed: true },
      { metric: "complexity", threshold: 10, actual: 8, passed: true },
      { metric: "typescript_strict", threshold: true, actual: true, passed: true },
      { metric: "tsdoc_complete", threshold: true, actual: true, passed: true }
    ]
  },
  {
    name: "å®‰å…¨é—¨ç¦",
    required: true,
    role: "Pentester",
    criteria: [
      { metric: "no_critical_vulnerabilities", threshold: 0, actual: 0, passed: true },
      { metric: "owasp_top_10", threshold: true, actual: true, passed: true },
      { metric: "stride_mitigated", threshold: true, actual: true, passed: true }
    ]
  },
  {
    name: "æ€§èƒ½é—¨ç¦",
    required: true,
    role: "QATester",
    criteria: [
      { metric: "api_response_time_p95", threshold: 100, actual: 75, passed: true },
      { metric: "memory_usage", threshold: 200, actual: 120, passed: true }
    ]
  }
];

// è´¨é‡é—¨ç¦æ£€æŸ¥
async function checkQualityGates(taskId: string): Promise<GateResult> {
  const results: QualityGate[] = [];

  for (const gate of qualityGates) {
    // æ¿€æ´»è´Ÿè´£è§’è‰²
    const role = activateRole(gate.role);

    // æ‰§è¡Œæ£€æŸ¥
    const result = await role.checkQuality(gate);
    results.push(result);

    // å¦‚æœå¿…é¡»é€šè¿‡çš„æ£€æŸ¥æœªé€šè¿‡ï¼Œç«‹å³å¤±è´¥
    if (gate.required && !result.passed) {
      return {
        passed: false,
        failedGate: gate.name,
        results: results
      };
    }
  }

  return {
    passed: true,
    results: results
  };
}
```

### 6.2 QATester æµç¨‹é›†æˆ

#### 6.2.1 QATester æ¿€æ´»æ—¶æœº

| æ—¶æœº | è§¦å‘æ¡ä»¶ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é•¿ |
|------|---------|-------|---------|
| **è®¾è®¡é˜¶æ®µ** | æ¶æ„è®¾è®¡å®Œæˆ | P1 | 2h |
| **å®ç°é˜¶æ®µ** | å•å…ƒæµ‹è¯•å®Œæˆ | P1 | 1h |
| **PR æäº¤** | Pull Request åˆ›å»º | P0 | 2h |
| **é›†æˆæµ‹è¯•** | å¤šæ¨¡å—é›†æˆå®Œæˆ | P1 | 4h |
| **é‡Œç¨‹ç¢‘** | é˜¶æ®µæ€§ä»»åŠ¡å®Œæˆ | P0 | 1d |

#### 6.2.2 QATester å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[QATester æ¿€æ´»] --> B{ä»»åŠ¡ç±»å‹?}

    B -->|è®¾è®¡è¯„å®¡| C[é˜…è¯»æ¶æ„æ–‡æ¡£]
    B -->|Code Review| D[è¯»å–ä»£ç å˜æ›´]
    B -->|æµ‹è¯•| E[è®¾è®¡æµ‹è¯•ç­–ç•¥]

    C --> F[æ£€æŸ¥è®¾è®¡åˆç†æ€§]
    D --> G[æ‰§è¡Œ Code Review]
    E --> H[ç¼–å†™æµ‹è¯•ç”¨ä¾‹]

    F --> I[è¾“å‡ºè¯„å®¡æ„è§]
    G --> I
    H --> J[æ‰§è¡Œæµ‹è¯•]

    I --> K{é€šè¿‡?}
    J --> L{é€šè¿‡?}

    K -->|å¦| M[åé¦ˆé—®é¢˜]
    K -->|æ˜¯| N[æ ‡è®°é€šè¿‡]
    L -->|å¦| M
    L -->|æ˜¯| N

    M --> O[é€šçŸ¥ç›¸å…³è§’è‰²]
    N --> P[æ›´æ–° TaskList]

    style K fill:#ffe1e1
    style L fill:#ffe1e1
    style N fill:#e1ffe1
```

#### 6.2.3 QATester å·¥ä½œæ¸…å•

**è®¾è®¡è¯„å®¡æ¸…å•ï¼š**
```markdown
## è®¾è®¡è¯„å®¡æ¸…å•ï¼ˆQATesterï¼‰

### æ¶æ„åˆç†æ€§
- [ ] åˆ†å±‚æ¶æ„æ¸…æ™°
- [ ] æ¨¡å—èŒè´£å•ä¸€
- [ ] æ¥å£è®¾è®¡åˆç†
- [ ] æ‰©å±•æ€§è€ƒè™‘å……åˆ†

### æŠ€æœ¯é€‰å‹
- [ ] æŠ€æœ¯æ ˆåˆé€‚
- [ ] ä¾èµ–åº“ç¨³å®š
- [ ] æ€§èƒ½æ»¡è¶³è¦æ±‚
- [ ] å®‰å…¨é£é™©å¯æ§

### è´¨é‡æ ‡å‡†
- [ ] æµ‹è¯•ç­–ç•¥å®Œæ•´
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•å……åˆ†
- [ ] ç›‘æ§æŒ‡æ ‡æ˜ç¡®
```

**Code Review æ¸…å•ï¼š**
```markdown
## Code Review æ¸…å•ï¼ˆQATesterï¼‰

### ä»£ç è´¨é‡
- [ ] éµå¾ª TypeScript ä¸¥æ ¼æ¨¡å¼
- [ ] å‘½åç¬¦åˆè§„èŒƒ
- [ ] ä»£ç ç»“æ„æ¸…æ™°
- [ ] æ³¨é‡Šå®Œæ•´å‡†ç¡®

### æµ‹è¯•è¦†ç›–
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >85%
- [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•å®Œæ•´
- [ ] é”™è¯¯å¤„ç†æœ‰æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### å®‰å…¨æ€§
- [ ] æ—  SQL æ³¨å…¥é£é™©
- [ ] æ—  XSS æ¼æ´
- [ ] æ•æ„Ÿæ•°æ®ä¿æŠ¤
- [ ] è¾“å…¥éªŒè¯å®Œæ•´

### æ€§èƒ½
- [ ] æ— æ˜æ˜¾æ€§èƒ½é—®é¢˜
- [ ] èµ„æºä½¿ç”¨åˆç†
- [ ] ç¼“å­˜ç­–ç•¥æœ‰æ•ˆ
- [ ] å¹¶å‘å¤„ç†æ­£ç¡®
```

### 6.3 ç¼ºé™·å›æº¯ä¸ä¿®å¤

#### 6.3.1 ç¼ºé™·åˆ†ç±»

```typescript
enum DefectSeverity {
  CRITICAL = "P0",  // ç³»ç»Ÿä¸å¯ç”¨ã€æ•°æ®æ³„éœ²
  HIGH = "P1",      // æ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸
  MEDIUM = "P2",    // åŠŸèƒ½é™çº§
  LOW = "P3"        // ä¼˜åŒ–å»ºè®®
}

enum DefectType {
  FUNCTIONAL = "functional",       // åŠŸèƒ½ç¼ºé™·
  PERFORMANCE = "performance",     // æ€§èƒ½é—®é¢˜
  SECURITY = "security",           // å®‰å…¨æ¼æ´
  USABILITY = "usability",         // æ˜“ç”¨æ€§é—®é¢˜
  MAINTAINABILITY = "maintainability" // å¯ç»´æŠ¤æ€§é—®é¢˜
}

interface Defect {
  id: string;
  title: string;
  description: string;
  severity: DefectSeverity;
  type: DefectType;
  foundBy: string;    // å‘ç°è§’è‰²
  assignedTo: string; // ä¿®å¤è§’è‰²
  status: 'open' | 'in_progress' | 'verified' | 'closed';
  steps: string[];    // å¤ç°æ­¥éª¤
  attachments?: string[];
  metadata: {
    taskId?: string;
    file?: string;
    line?: number;
  };
}
```

#### 6.3.2 ç¼ºé™·ä¿®å¤æµç¨‹

```mermaid
graph TD
    A[QATester å‘ç°ç¼ºé™·] --> B[è®°å½•ç¼ºé™·è¯¦æƒ…]
    B --> C[åˆ†é…ç»™ç›¸å…³è§’è‰²]
    C --> D[è§’è‰²ä¿®å¤ç¼ºé™·]
    D --> E[æäº¤ä¿®å¤]
    E --> F[QATester éªŒè¯]
    F --> G{éªŒè¯é€šè¿‡?}
    G -->|å¦| H[è¿”å›é‡æ–°ä¿®å¤]
    G -->|æ˜¯| I[å…³é—­ç¼ºé™·]
    H --> D
    I --> J[æ›´æ–°æ–‡æ¡£]

    style A fill:#fff4e1
    style F fill:#ffe1e1
    style I fill:#e1ffe1
```

**ä¿®å¤æ—¶é™ï¼š**
| ä¸¥é‡çº§åˆ« | å“åº”æ—¶é—´ | ä¿®å¤æ—¶é™ | éªŒè¯æ—¶é™ |
|---------|---------|---------|---------|
| **P0** | <15 åˆ†é’Ÿ | <4 å°æ—¶ | <1 å°æ—¶ |
| **P1** | <1 å°æ—¶ | <1 å¤© | <4 å°æ—¶ |
| **P2** | <4 å°æ—¶ | <3 å¤© | <1 å¤© |
| **P3** | <1 å¤© | <1 å‘¨ | <1 å¤© |

#### 6.3.3 å›æº¯åˆ†æ

```typescript
interface RootCauseAnalysis {
  defectId: string;
  rootCause: string;
  contributingFactors: string[];
  preventionMeasures: string[];
  actionItems: ActionItem[];
}

// ç¼ºé™·å›æº¯åˆ†æ
async function analyzeRootCause(defect: Defect): Promise<RootCauseAnalysis> {
  // 1. è¯†åˆ«æ ¹æœ¬åŸå› 
  const rootCause = identifyRootCause(defect);

  // 2. è¯†åˆ«ä¿ƒæˆå› ç´ 
  const contributingFactors = [
    "è®¾è®¡é˜¶æ®µæœªè€ƒè™‘æ­¤åœºæ™¯",
    "ç¼ºå°‘å•å…ƒæµ‹è¯•è¦†ç›–",
    "Code Review æœªå‘ç°"
  ];

  // 3. åˆ¶å®šé¢„é˜²æªæ–½
  const preventionMeasures = [
    "æ›´æ–°è®¾è®¡æ£€æŸ¥æ¸…å•ï¼Œæ·»åŠ æ­¤åœºæ™¯",
    "å¢åŠ å•å…ƒæµ‹è¯•ç”¨ä¾‹",
    "Code Review æ¸…å•æ·»åŠ æ­¤é¡¹æ£€æŸ¥"
  ];

  // 4. åˆ¶å®šè¡ŒåŠ¨è®¡åˆ’
  const actionItems = [
    { action: "æ›´æ–°æ£€æŸ¥æ¸…å•", assignee: "QATester", deadline: "2026-02-07" },
    { action: "ç¼–å†™æµ‹è¯•ç”¨ä¾‹", assignee: "Engineer", deadline: "2026-02-07" }
  ];

  return {
    defectId: defect.id,
    rootCause,
    contributingFactors,
    preventionMeasures,
    actionItems
  };
}
```

---

## 7. å®æ–½æŒ‡å—

### 7.1 å·¥å…·æ”¯æŒ

#### 7.1.1 TaskList å·¥å…·å¢å¼º

**ç°æœ‰åŠŸèƒ½ï¼š**
- TaskListï¼šåˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
- TaskGetï¼šè·å–ä»»åŠ¡è¯¦æƒ…
- TaskUpdateï¼šæ›´æ–°ä»»åŠ¡çŠ¶æ€
- TaskCreateï¼šåˆ›å»ºæ–°ä»»åŠ¡

**éœ€è¦å¢å¼ºï¼š**
```typescript
// 1. ä»»åŠ¡è·¯ç”±
interface TaskListEnhanced {
  routeTask(task: TaskDescription): RouteDecision;
  suggestAssignee(task: TaskDescription): string;
  estimateComplexity(task: TaskDescription): Complexity;
}

// 2. å†²çªæ£€æµ‹
interface ConflictDetection {
  detectConflicts(tasks: Task[]): Conflict[];
  suggestResolution(conflict: Conflict): Resolution;
  autoResolve(conflict: Conflict): boolean;
}

// 3. ä¾èµ–ç®¡ç†
interface DependencyManagement {
  addDependency(fromTask: string, toTask: string): void;
  removeDependency(fromTask: string, toTask: string): void;
  visualizeDependencies(): DependencyGraph;
  detectCircularDependencies(): Cycle[];
}
```

#### 7.1.2 æ¶ˆæ¯æ€»çº¿

```typescript
// ç®€å•çš„æ¶ˆæ¯æ€»çº¿å®ç°ï¼ˆåŸºäºæ–‡ä»¶ç³»ç»Ÿï¼‰
class MessageBus {
  private channels: Map<string, Set<Listener>> = new Map();

  // å‘å¸ƒæ¶ˆæ¯
  async publish(channel: string, message: any): Promise<void> {
    const listeners = this.channels.get(channel) || new Set();
    for (const listener of listeners) {
      await listener(message);
    }
  }

  // è®¢é˜…é¢‘é“
  subscribe(channel: string, listener: Listener): () => void {
    if (!this.channels.has(channel)) {
      this.channels.set(channel, new Set());
    }
    this.channels.get(channel)!.add(listener);

    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => {
      this.channels.get(channel)?.delete(listener);
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const messageBus = new MessageBus();

// Coordinator ç›‘å¬ä»»åŠ¡å®Œæˆ
messageBus.subscribe("task:completed", async (task: Task) => {
  console.log(`ä»»åŠ¡ ${task.id} å®Œæˆ`);
  await coordinator.onTaskCompleted(task);
});

// QATester ç›‘å¬ PR åˆ›å»º
messageBus.subscribe("pr:created", async (pr: PullRequest) => {
  console.log(`PR #${pr.number} åˆ›å»ºï¼Œå‡†å¤‡ Code Review`);
  await qaTester.onPRCreated(pr);
});
```

#### 7.1.3 è´¨é‡é—¨ç¦å·¥å…·

```typescript
// è´¨é‡é—¨ç¦æ£€æŸ¥è„šæœ¬
class QualityGateChecker {
  async check(taskId: string): Promise<QualityGateResult> {
    // 1. æµ‹è¯•è¦†ç›–ç‡
    const coverage = await this.getCoverage(taskId);
    if (coverage < 0.85) {
      return { passed: false, reason: `æµ‹è¯•è¦†ç›–ç‡ ${coverage} < 85%` };
    }

    // 2. TypeScript ä¸¥æ ¼æ¨¡å¼
    const typeCheck = await this.typeCheck(taskId);
    if (!typeCheck.passed) {
      return { passed: false, reason: "TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥" };
    }

    // 3. ESLint
    const lint = await this.lint(taskId);
    if (!lint.passed) {
      return { passed: false, reason: `ESLint é”™è¯¯ï¼š${lint.errors}` };
    }

    // 4. å®‰å…¨æ‰«æ
    const security = await this.securityScan(taskId);
    if (security.critical > 0) {
      return { passed: false, reason: `å‘ç° ${security.critical} ä¸ªé«˜å±æ¼æ´` };
    }

    return { passed: true };
  }
}
```

### 7.2 é›†æˆåˆ° PAI Algorithm

#### 7.2.1 PAI Algorithm å¹¶è¡Œæ‰§è¡ŒåŸåˆ™

**Fan-out é»˜è®¤æ¨¡å¼ï¼š**
```typescript
// PAI Algorithm æ ¸å¿ƒé€»è¾‘ï¼ˆç®€åŒ–ï¼‰
async function paiAlgorithm(task: Task): Promise<Result> {
  // 1. ä»»åŠ¡åˆ†è§£
  const subtasks = decomposeTask(task);

  // 2. é»˜è®¤ Fan-out å¹¶è¡Œæ‰§è¡Œ
  if (canExecuteInParallel(subtasks)) {
    const results = await Promise.all(
      subtasks.map(subtask => executeSubtask(subtask))
    );
    return mergeResults(results);
  }

  // 3. æœ‰ä¾èµ–åˆ™ Pipeline ä¸²è¡Œæ‰§è¡Œ
  else {
    let result;
    for (const subtask of subtasks) {
      result = await executeSubtask(subtask);
    }
    return result;
  }
}
```

**é›†æˆååŒæœºåˆ¶ï¼š**
```typescript
// å¢å¼ºçš„ PAI Algorithm
async function paiAlgorithmWithCollaboration(
  task: Task,
  context: ProjectContext
): Promise<Result> {
  // 1. ä»»åŠ¡è·¯ç”±ï¼ˆæ–°å¢ï¼‰
  const route = routeTask(task);
  console.log(`ä»»åŠ¡è·¯ç”±åˆ°ï¼š${route.primaryRole}`);

  // 2. å†²çªæ£€æµ‹ï¼ˆæ–°å¢ï¼‰
  const conflicts = detectConflicts([task, ...context.tasks]);
  if (conflicts.length > 0) {
    console.warn(`æ£€æµ‹åˆ° ${conflicts.length} ä¸ªå†²çª`);
    await resolveConflicts(conflicts);
  }

  // 3. ç¡®å®šæ‰§è¡Œæ¨¡å¼
  const executionMode = determineExecutionMode(task, route);

  // 4. æ‰§è¡Œä»»åŠ¡
  if (executionMode === "fan-out") {
    return await executeFanOut(task, route);
  } else if (executionMode === "pipeline") {
    return await executePipeline(task, route);
  } else if (executionMode === "council") {
    return await executeCouncil(task, route);
  }

  // 5. è´¨é‡æ£€æŸ¥ï¼ˆæ–°å¢ï¼‰
  const qualityResult = await checkQualityGates(task.id);
  if (!qualityResult.passed) {
    throw new Error(`è´¨é‡é—¨ç¦å¤±è´¥ï¼š${qualityResult.failedGate}`);
  }

  return result;
}
```

#### 7.2.2 è§’è‰²æ¿€æ´»é›†æˆ

```typescript
// è§’è‰²æ¿€æ´»å™¨
class RoleActivator {
  async activate(
    role: string,
    task: Task,
    context: ProjectContext
  ): Promise<RoleInstance> {
    // 1. åŠ è½½è§’è‰²ä¸Šä¸‹æ–‡
    const roleContext = await loadRoleContext(role);

    // 2. åˆ›å»ºè§’è‰²å®ä¾‹
    const instance = new RoleInstance(role, roleContext);

    // 3. åˆ†é…ä»»åŠ¡
    await instance.assignTask(task);

    // 4. é€šçŸ¥ç›¸å…³è§’è‰²
    await notifyCollaborators(instance, task);

    return instance;
  }

  async deactivate(instance: RoleInstance): Promise<void> {
    // 1. ä¿å­˜å·¥ä½œæˆæœ
    await instance.saveWork();

    // 2. æ›´æ–°ä¸Šä¸‹æ–‡
    await updateContext(instance);

    // 3. é€šçŸ¥ Coordinator
    await notifyCoordinator({ type: "role_deactivated", role: instance.role });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const activator = new RoleActivator();

// æ¿€æ´» Pentester
const pentester = await activator.activate("Pentester", task, context);

// æ‰§è¡Œä»»åŠ¡
await pentester.execute(task);

// å®Œæˆååœç”¨
await activator.deactivate(pentester);
```

### 7.3 é¢„æœŸæ•ˆæœ

#### 7.3.1 æ•ˆç‡æå‡

| æŒ‡æ ‡ | å½“å‰ï¼ˆå•äººï¼‰ | ç›®æ ‡ï¼ˆè™šæ‹Ÿå›¢é˜Ÿï¼‰ | æå‡ |
|------|-------------|----------------|------|
| **ä»»åŠ¡å®Œæˆé€Ÿåº¦** | åŸºçº¿ | +30% | Fan-out å¹¶è¡Œæ‰§è¡Œ |
| **ä»£ç è´¨é‡** | >85% è¦†ç›–ç‡ | >90% è¦†ç›–ç‡ | QATester æŒç»­ Code Review |
| **å®‰å…¨æ¼æ´æ•°** | æœªçŸ¥ | P0 æ¼æ´ä¸º 0 | Pentester æå‰ä»‹å…¥ |
| **æ–‡æ¡£å®Œæ•´æ€§** | ~80% | 100% | Writer è‡ªåŠ¨è·Ÿè¿› |

#### 7.3.2 è´¨é‡ä¿éšœ

**å†…å»ºè´¨é‡æœºåˆ¶ï¼š**
1. **è®¾è®¡é˜¶æ®µ** - Architect è¯„å®¡è®¾è®¡
2. **å®ç°é˜¶æ®µ** - Engineer TDD å¼€å‘
3. **è¯„å®¡é˜¶æ®µ** - QATester Code Review
4. **æµ‹è¯•é˜¶æ®µ** - QATester + Pentester åŒé‡éªŒè¯
5. **éªŒæ”¶é˜¶æ®µ** - Coordinator æœ€ç»ˆæŠŠå…³

**ç¼ºé™·é¢„é˜²ï¼š**
- å¨èƒå»ºæ¨¡æå‰è¯†åˆ«å®‰å…¨é£é™©
- Code Review åŠæ—¶å‘ç°ä»£ç é—®é¢˜
- è´¨é‡é—¨ç¦ç¡®ä¿è´¨é‡åº•çº¿
- å›æº¯åˆ†ææŒç»­æ”¹è¿›æµç¨‹

#### 7.3.3 åä½œæ•ˆç‡

**åä½œæ•ˆæœï¼š**
- **ä»»åŠ¡è·¯ç”±å‡†ç¡®ç‡** >95% - è‡ªåŠ¨åŒ¹é…æœ€åˆé€‚çš„è§’è‰²
- **å†²çªè§£å†³æ—¶é—´** <2h - å¿«é€Ÿè¯†åˆ«å’Œè§£å†³å†²çª
- **ä¸Šä¸‹æ–‡å…±äº«å®Œæ•´åº¦** >85% - è§’è‰²é—´ä¿¡æ¯é€æ˜
- **å¹¶è¡Œæ‰§è¡Œæ•ˆç‡** +40% - Fan-out å¹¶è¡Œæ‰§è¡Œ

**è¡¡é‡æ–¹å¼ï¼š**
```typescript
// åä½œæ•ˆç‡æŒ‡æ ‡
interface CollaborationMetrics {
  // ä»»åŠ¡è·¯ç”±
  routingAccuracy: number;      // è·¯ç”±å‡†ç¡®ç‡
  avgRoutingTime: number;       // å¹³å‡è·¯ç”±æ—¶é—´

  // å¹¶è¡Œæ‰§è¡Œ
  fanoutEfficiency: number;     // Fan-out æ•ˆç‡æå‡
  avgParallelTasks: number;     // å¹³å‡å¹¶è¡Œä»»åŠ¡æ•°

  // å†²çªè§£å†³
  avgConflictResolutionTime: number; // å¹³å‡å†²çªè§£å†³æ—¶é—´
  conflictPreventionRate: number;    // å†²çªé¢„é˜²ç‡

  // è´¨é‡ä¿éšœ
  qualityGatePassRate: number;  // è´¨é‡é—¨ç¦é€šè¿‡ç‡
  defectEscapeRate: number;     // ç¼ºé™·é€ƒé€¸ç‡

  // ä¸Šä¸‹æ–‡å…±äº«
  contextCompleteness: number;  // ä¸Šä¸‹æ–‡å®Œæ•´åº¦
  avgContextLoadTime: number;   // å¹³å‡ä¸Šä¸‹æ–‡åŠ è½½æ—¶é—´
}
```

---

## 8. é™„å½•

### 8.1 å®Œæ•´ä»»åŠ¡è·¯ç”±å†³ç­–æ ‘

```
æ–°ä»»åŠ¡è¾“å…¥
    â”‚
    â”œâ”€ åŒ…å«å…³é”®è¯ï¼š"å®‰å…¨"ã€"æ¼æ´"ã€"OWASP"ã€"STRIDE"
    â”‚   â””â”€> ä¼˜å…ˆçº§è¯„ä¼°
    â”‚       â”œâ”€ P0ï¼ˆé«˜å±ï¼‰ â†’ ç«‹å³æ¿€æ´» Pentesterï¼ˆå¿«é€Ÿé€šé“ï¼‰
    â”‚       â”œâ”€ P1ï¼ˆä¸­å±ï¼‰ â†’ åŠ å…¥ Pentester é˜Ÿåˆ—
    â”‚       â””â”€ P2ï¼ˆä½å±ï¼‰ â†’ åŠ å…¥ Pentester é˜Ÿåˆ—
    â”‚
    â”œâ”€ åŒ…å«å…³é”®è¯ï¼š"æ¶æ„"ã€"è®¾è®¡"ã€"æŠ€æœ¯é€‰å‹"ã€"é‡æ„"
    â”‚   â””â”€ å¤æ‚åº¦è¯„ä¼°
    â”‚       â”œâ”€ ç®€å• â†’ æ¿€æ´» Architectï¼ˆç‹¬ç«‹å®Œæˆï¼‰
    â”‚       â”œâ”€ ä¸­ç­‰ â†’ Architect + Researcherï¼ˆå¹¶è¡Œè°ƒç ”ï¼‰
    â”‚       â””â”€ å¤æ‚ â†’ Council æ¨¡å¼ï¼ˆå¤šè§’è‰²è®¨è®ºï¼‰
    â”‚
    â”œâ”€ åŒ…å«å…³é”®è¯ï¼š"å®ç°"ã€"å¼€å‘"ã€"ä¿®å¤"ã€"ç¼–ç "
    â”‚   â””â”€ å¤æ‚åº¦è¯„ä¼°
    â”‚       â”œâ”€ ç®€å• â†’ æ¿€æ´» Engineerï¼ˆç‹¬ç«‹å®Œæˆï¼‰
    â”‚       â”œâ”€ ä¸­ç­‰ â†’ Engineer + QATesterï¼ˆPipelineï¼‰
    â”‚       â””â”€ å¤æ‚ â†’ Engineer + Architectï¼ˆè®¾è®¡æ”¯æŒï¼‰ + QATesterï¼ˆPipelineï¼‰
    â”‚
    â”œâ”€ åŒ…å«å…³é”®è¯ï¼š"æµ‹è¯•"ã€"éªŒè¯"ã€"Code Review"
    â”‚   â””â”€> æ¿€æ´» QATester
    â”‚
    â”œâ”€ åŒ…å«å…³é”®è¯ï¼š"æ•°æ®"ã€"åˆ†æ"ã€"æŒ‡æ ‡"ã€"æŠ¥å‘Š"
    â”‚   â””â”€> æ¿€æ´» Analyst
    â”‚
    â”œâ”€ åŒ…å«å…³é”®è¯ï¼š"æ–‡æ¡£"ã€"README"ã€"API æ–‡æ¡£"
    â”‚   â””â”€> æ¿€æ´» Writer
    â”‚
    â””â”€ å…¶ä»–
        â””â”€> æ¿€æ´» Coordinatorï¼ˆåè°ƒåˆ†é…ï¼‰
```

### 8.2 åä½œæ¨¡å¼é€ŸæŸ¥è¡¨

| æ¨¡å¼ | è§¦å‘æ¡ä»¶ | è§’è‰²æ•° | æ‰§è¡Œæ–¹å¼ | ç¤ºä¾‹åœºæ™¯ |
|------|---------|-------|---------|---------|
| **å•è§’è‰²** | ç®€å•ä»»åŠ¡ï¼Œ<2h | 1 | ç‹¬ç«‹ | æ–‡æ¡£æ›´æ–°ã€ç®€å• Bug ä¿®å¤ |
| **é“¾å¼åä½œ** | ä¸­ç­‰ä»»åŠ¡ï¼Œæœ‰ä¾èµ– | 2-3 | Pipeline | è®¾è®¡ â†’ å®ç° â†’ æµ‹è¯• |
| **å¹¶è¡Œåä½œ** | ç‹¬ç«‹å­ä»»åŠ¡ | 2-4 | Fan-out | æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤šè§’è‰²å¹¶è¡Œåˆ†æï¼‰ |
| **æ··åˆæ¨¡å¼** | å¤æ‚ä»»åŠ¡ | 3-5 | Pipeline + Fan-out | API å®‰å…¨åŠ å›º |
| **Council æ¨¡å¼** | é‡å¤§å†³ç­– | 3-7 | è®¨è®º â†’ å†³ç­– â†’ æ‰§è¡Œ | æ¶æ„é‡å¤§å˜æ›´ |

### 8.3 å†²çªè§£å†³é€ŸæŸ¥è¡¨

| å†²çªç±»å‹ | æ£€æµ‹æ–¹æ³• | è§£å†³ç­–ç•¥ | é¢„é˜²æªæ–½ |
|---------|---------|---------|---------|
| **èµ„æºå†²çª** | TaskList ä¸­ç›¸åŒ assignee | ä¼˜å…ˆçº§æ’åºï¼ˆP0 > P1 > P2 > P3ï¼‰ | ä»»åŠ¡åˆ†åŒºã€è§’è‰²å¤‡ä»½ |
| **ä¾èµ–å†²çª** | å¾ªç¯ä¾èµ–æ£€æµ‹ | è°ƒæ•´ä»»åŠ¡é¡ºåºæˆ–åˆå¹¶ä»»åŠ¡ | ä¾èµ–å…³ç³»å¯è§†åŒ– |
| **ä¼˜å…ˆçº§å†²çª** | P0 ä»»åŠ¡æ•° > è§’è‰²å¯ç”¨æ•° | è¯„ä¼°ç´§æ€¥ç¨‹åº¦ï¼Œä¸²è¡Œæ‰§è¡Œ | ä¼˜å…ˆçº§è¯„ä¼°çŸ©é˜µ |
| **è¾“å‡ºå†²çª** | codeFiles é‡å  | åŠ é”æˆ–åˆå¹¶ä»»åŠ¡ | æ–‡ä»¶é”å®šã€æ¨¡å—åˆ†åŒº |

### 8.4 è´¨é‡æ£€æŸ¥æ¸…å•

**è®¾è®¡é˜¶æ®µï¼š**
- [ ] æ¶æ„è®¾è®¡æ–‡æ¡£å®Œæ•´
- [ ] ADR è®°å½•åˆ›å»º
- [ ] æŠ€æœ¯é€‰å‹æœ‰ä¾æ®
- [ ] æ‰©å±•æ€§è€ƒè™‘å……åˆ†

**å®ç°é˜¶æ®µï¼š**
- [ ] TypeScript ä¸¥æ ¼æ¨¡å¼é€šè¿‡
- [ ] TSDoc æ³¨é‡Šå®Œæ•´
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >85%
- [ ] é”™è¯¯å¤„ç†å®Œå–„

**è¯„å®¡é˜¶æ®µï¼š**
- [ ] Code Review é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡ï¼ˆOWASP Top 10ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**éªŒæ”¶é˜¶æ®µï¼š**
- [ ] åŠŸèƒ½å®Œæ•´æ€§éªŒè¯
- [ ] æ–‡æ¡£å®Œæ•´æ€§éªŒè¯
- [ ] è´¨é‡é—¨ç¦é€šè¿‡
- [ ] ç”¨æˆ·éªŒæ”¶é€šè¿‡

---

## æ€»ç»“

æœ¬æ–‡æ¡£è®¾è®¡äº† ReflectGuard è™šæ‹Ÿå›¢é˜ŸååŒå·¥ä½œæœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼š

**æ ¸å¿ƒæˆæœï¼š**
1. âœ… **ä»»åŠ¡è·¯ç”±æœºåˆ¶** - è‡ªåŠ¨åˆ†ç±»å’Œè·¯ç”±ä»»åŠ¡åˆ°åˆé€‚çš„è§’è‰²
2. âœ… **å¹¶è¡Œæ‰§è¡Œç­–ç•¥** - Fan-out å’Œ Pipeline é€‰æ‹©é€»è¾‘
3. âœ… **å†²çªè§£å†³æµç¨‹** - å¤šå±‚æ¬¡çš„å†²çªæ£€æµ‹å’Œè§£å†³æœºåˆ¶
4. âœ… **é€šä¿¡åè®®** - è§’è‰²é—´æ¶ˆæ¯ä¼ é€’å’ŒçŠ¶æ€åŒæ­¥
5. âœ… **è´¨é‡ä¿è¯é›†æˆ** - å†…å»ºè´¨é‡æ£€æŸ¥ç‚¹å’Œé—¨ç¦
6. âœ… **å®æ–½æŒ‡å—** - å·¥å…·æ”¯æŒå’Œé¢„æœŸæ•ˆæœ

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- **æ™ºèƒ½è·¯ç”±** - åŸºäºå…³é”®è¯å’Œå¤æ‚åº¦è‡ªåŠ¨è·¯ç”±
- **é«˜æ•ˆå¹¶è¡Œ** - Fan-out é»˜è®¤æ¨¡å¼ï¼Œæœ€å¤§åŒ–å¹¶è¡Œæ‰§è¡Œ
- **å†²çªé¢„é˜²** - æå‰è¯†åˆ«å’Œé¢„é˜²å†²çª
- **è´¨é‡å†…å»º** - è´¨é‡æ£€æŸ¥èå…¥æ¯ä¸ªç¯èŠ‚
- **ç®€å•é«˜æ•ˆ** - åŸºäºç°æœ‰å·¥å…·ï¼Œè½»é‡çº§å®ç°

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š**
1. Day 1 ä¸‹åˆï¼šåœ¨ API å®‰å…¨åŠ å›ºä»»åŠ¡ä¸­è¯•è¿è¡ŒååŒæœºåˆ¶
2. Day 2-3ï¼šåŸºäºå®é™…ä½¿ç”¨åé¦ˆä¼˜åŒ–æœºåˆ¶
3. Day 4-5ï¼šå®Œå–„å·¥å…·æ”¯æŒï¼ˆTaskList å¢å¼ºã€æ¶ˆæ¯æ€»çº¿ï¼‰
4. Day 6-7ï¼šè¯„ä¼°æ•ˆæœå¹¶ç”Ÿæˆæ”¹è¿›æŠ¥å‘Š

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0
**æœ€åæ›´æ–°ï¼š** 2026-02-05
**ç»´æŠ¤è€…ï¼š** ReflectGuard Team
**çŠ¶æ€ï¼š** âœ… å®Œæˆ
